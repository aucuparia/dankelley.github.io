---
layout: post
title: solar navigation
tags: [R, oce, astronomy]
category: R
year: 2014
month: 11
day: 10
summary: Geographical location is inferred from sunrise and sunset times.
latex: true
---

# Introduction

Solar altitude is a function of time, longitude and latitude, and so it can be
possible to infer location based on measuring altitude as a function of time.
This form of solar navigation can be based on sunrise and sunset times, at
least on non-equinox days.

I have explored this for a school-based project I call "SkyView" [1] involving
light sensors and Arduino microcontrollers, and I suspect that readers could
imagine other applications as well.

I will illustrate the ideas and the accuracy of the method based on the example
of sunrise and sunset on Remembrance Day in Halifax, Nova Scotia, a city where
respect for the fallen is very strong.

# Methods and results

According to various websites [e.g. 2], sunrise on the Halifax Remembrance Day
sunrise is at 7:06AM (11:06 UTC), with sunset at 4:51PM (20:51 UTC).

Rather than devising an inverse formula to infer location from time and solar
altitude, the R function ``optim`` may be used to find the longitude and
latitude that minimize angle the sun makes to the horizon.  That angle is given
by the ``altitude`` component of the list returned by ``oce::solarAngle()``.

Thus, a method for inferring the location of Halifax is as follows.  The first
step is to define a function that returns the absolute value of the solar
angle, which of course is zero at the horizon.  We will try using paired
sunrise and sunset, although of course other alternatives come to mind in
various applications.

```{r,message=FALSE,warning=FALSE}
library(oce)
misfit <- function(lonlat)
{
    riseAlt <- sunAngle(rise, longitude=lonlat[1], latitude=lonlat[2], useRefraction=TRUE)$altitude
    setAlt <- sunAngle(set, longitude=lonlat[1], latitude=lonlat[2], useRefraction=TRUE)$altitude
    0.5 * (abs(riseAlt) + abs(setAlt))
}
```
Here, ``useRefraction`` has been used, to account for the bending of the
sunlight near the horizon, which perturbs the observed sunrise and sunset
times.  See ``help(sunAngle)`` for more about how this function works,
including details on the return values, of which only altitude is used here.

The goal here is to use ``optim`` to find the optimal values of longitude and
latitude.  This function needs an initial value, or guess, and for that we pick
50W and 50N, as a very rough estimate.
```{r}
start <- c(-50, 50) # set this vaguely near the expected location
rise <- as.POSIXct("2014-11-11 11:06:00", tz="UTC")
set <- as.POSIXct("2014-11-11 20:51:00", tz="UTC")
bestfit <- optim(start, misfit)
```
Before moving on, it makes sense to look at this fit.
```{r}
str(bestfit)
```
The function value is very low, indicating a sun just on the horizon, as
expected for a converged solution.  The optimal values for longitude and
latitude are stored in ``par``. See ``help("optim")`` to learn more about the
return value.

It can be helpful to show the results on a map.  To explore the effect of
dependence on precise sunrise and sunset times, random values can be added to
those times and resultant positions plotted.  In the present example, the times
are reported just to the nearest minute, so random values with standard
deviation of 30 seconds will be used.

```{r solar-navigation, fig.height=4, fig.width=7, dpi=100}
data(coastlineWorldFine, package="ocedata")
plot(coastlineWorldFine, clon=-64, clat=45, span=500)
grid()

n <- 25                                # use 25 perturbations
rises <- rise + rnorm(n, sd=30)
sets <- set + rnorm(n, sd=30)
set.seed(20141111) # this lets readers reproduce this exactly
for (i in 1:n) {
    rise <- rises[i]
    set <- sets[i]
    fit <- optim(start, misfit)
    points(fit$par[1], fit$par[2], pch=21, bg="pink", cex=1.4)
}
# Show the unperturbed fit
points(bestfit$par[1], bestfit$par[2], pch=21, cex=2, bg="red")
# Show the actual location of Halifax
points(-63.571, 44.649, pch=22, cex=2, bg='yellow')
# A legend summarizes all this work
legend("bottomright", bg="white", 
       pch=c(21, 21, 22), pt.bg=c("red", "pink", "yellow"),
       legend=c("Best", "Range", "True"))
```

# Results

The diagram indicates that reported sunrise and sunset times are sufficient to
locate Halifax to within about 10km.  (Note that 1 degree of latitude is
111km.)

Adjusting sunrise and sunset times by half a minute (corresponding to the
rounding interval in public forecasts of sunrise and sunset times) yields
approximately 25km of uncertainty in geographical position.  Extending the code
to develop a statistical statement is trivial.

# Discussion and conclusions

Sunrise-sunset navigation to one-minute temporal resolution can yield
accuracies in the range of 10km.  This is encouraging enough to make for a fun
school project, with necessary provisos about not looking directly at the sun.

Readers interested in exploring the uncertainty through the year should find
the R code simple to modify.  It is also easy to express the uncertainty
statistically.

Further discussion of matters relating to solar angles can be found in my
upcoming book [3].  For example, the method can be used to test a famous line
in a Carly Simon song.


# Resources

1. A website for the SkyView project is
[http://emit.phys.ocean.dal.ca/~kelley/skyview](http://emit.phys.ocean.dal.ca/~kelley/skyview/).
   
2. A website providing the requisite sunrise and sunset times is
[http://www.timeanddate.com/astronomy/canada/halifax](http://www.timeanddate.com/astronomy/canada/halifax).

3. Dan Kelley, in preparation.  Oceanographic Analysis with R. Springer-Verlag.

4. Source code: [2014-11-10-solar-navigation.R]({{ site.url }}/assets/2014-11-10-solar-navigation.R).

