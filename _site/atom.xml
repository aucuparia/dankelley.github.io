<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>Recursive</title>
 <link href="http://dankelley.github.io/atom.xml" rel="self"/>
 <link href="http://dankelley.github.io"/>
 <updated>2014-03-22T18:38:35-03:00</updated>
 <id>http://dankelley.github.io/</id>
 <author>
   <name>DanKelley</name>
   <email>dan.kelley@dal.ca</email>
 </author>

 
 <entry>
   <title>Sun and moon paths in daily sky</title>
   <link href="http://dankelley.github.io/blog//r/2014/03/22/sun-moon.html"/>
   <updated>2014-03-22T00:00:00-03:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/03/22/sun-moon</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;This blog started because I was interested in the sunrise position on the winter solstice of 2013. With the Spring equinox, I’m trying something different: plotting the paths of the sun and moon through the day.&lt;/p&gt;

&lt;p&gt;The code shown here produces a daily graph, and I have a cron job running on a machine so that this graph is visible to anyone at &lt;a href=&quot;http://emit.phys.ocean.dal.ca/~kelley/sunmoon&quot;&gt;my website&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;procedure&quot;&gt;Procedure&lt;/h1&gt;

&lt;p&gt;The Oce package has functions called &lt;code&gt;moonAngle()&lt;/code&gt; and &lt;code&gt;sunAngle()&lt;/code&gt; that do the calculations. The rest of this code sets up and graphs the results. The horizon is on the outer edge of the circle. Hours (local time) are marked along the sun and moon paths. East-west and North-south lines are shown, and they intersect at the zenith.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Loading required package: methods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;angles &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;day &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; Sys.Date&lt;span class=&#39;p&#39;&gt;(),&lt;/span&gt; lon &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-63.61&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;44.67&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;America/Halifax&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    sun &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    tUTC &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;paste&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;day&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;00:00:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; tz &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; tz&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;240&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
        by &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;6 min&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    attributes&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;tUTC&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;tzone &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;
    a &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sun&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; 
        sunAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;tUTC&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; lon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; lat&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; moonAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;tUTC&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; lon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; lat&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    invisible &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; a&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
    a&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;invisible&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NA&lt;/span&gt;
    a&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;invisible&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NA&lt;/span&gt;
    list&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; altitude &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; a&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; azimuth &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; a&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

day &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; Sys.Date&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
tz &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;America/Halifax&amp;quot;&lt;/span&gt;
s &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; angles&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
m &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; angles&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sun &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
max &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.04&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;s&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; m&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; na.rm &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
theta &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;24&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
radiusx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;theta&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
radiusy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;theta&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;# Horizon and labels+lines for EW and NS&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;radiusx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; radiusy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; axes &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xlab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    ylab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
D &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.06&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;D&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;S&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xpd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# xpd so can go in margin&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;D&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;W&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xpd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; D&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;N&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xpd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;D&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;E&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xpd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## Moon&lt;/span&gt;
mx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; m&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; m&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
my &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; m&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; m&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; my&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; s&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;t
mlt &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sprintf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;%s %02d:00:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; day&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; tz &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; tz&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
ti &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; unlist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lapply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mlt&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;X&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; which.min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;abs&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;X &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;))))&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mx&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; my&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mx&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; my&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## Sun&lt;/span&gt;
sx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; s&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; s&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
sy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; s&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; s&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
slt &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sprintf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;%s %02d:00:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; day&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; tz &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; tz&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
si &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; unlist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lapply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;slt&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;X&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; which.min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;abs&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;X &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;))))&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sx&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; sy&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sx&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; sy&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;ti&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;paste&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Halifax NS&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; day&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sep &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; side &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; line &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Red sun\nBlue moon&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; line &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-03-22-sunmoon.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://emit.phys.ocean.dal.ca/~kelley/sunmoon/&quot;&gt;Website&lt;/a&gt; with daily graph for Halifax, Nova Scotia.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Source code: &lt;a href=&quot;/assets/2014-03-22-sun-moon.R&quot;&gt;2014-03-22-sun-moon.R&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>Box models in R</title>
   <link href="http://dankelley.github.io/blog//r/2014/03/16/box-model.html"/>
   <updated>2014-03-16T00:00:00-03:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/03/16/box-model</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Box models are popular in some branches of oceanography and other geophysical disciplines, partly because they are simple to construct and to solve. This posting shows how to solve a box model in R, using the &lt;code&gt;lsoda()&lt;/code&gt; function in the &lt;code&gt;deSolve&lt;/code&gt; package.&lt;/p&gt;

&lt;p&gt;The basic ideas can be explained in the context of riverine input into a lake that connects to the sea. Readers with mathematical expertise will see easily that the same method holds for a wide variety of problems. An oceanographer might think of salinity reduction. A meteorologist might think of the seasonal lag of ocean temperature. A pharmacologist might think of the concentration of a drug in the bloodstream. A contractor might think of water in a basement. But let’s stick to the lake, shall we?&lt;/p&gt;

&lt;h1 id=&quot;model_formulation&quot;&gt;Model formulation&lt;/h1&gt;

&lt;p&gt;Let the lake surface area be &lt;em&gt;A&lt;/em&gt;, and its water level be &lt;em&gt;h&lt;/em&gt;, with the latter being expressed as height above (constant) sea level. Let the river input volume per unit time be &lt;em&gt;F&lt;/em&gt;. Suppose that the lake drains into the sea with volume output per unit time given by a linear law (as perhaps with pressure-driven viscous flow) of the form $$\gamma h$$ where the coefficient has units of area per time.&lt;/p&gt;

&lt;p&gt;The principle of volume conservation yields the differential equation $$A\frac{dh}{dt} = F - \gamma h$$ where the left-hand side is the changing volume of the lake (assuming vertical coastline). In this equation, &lt;em&gt;F&lt;/em&gt; may vary with time as rivers flow and ebb, driven by rainfall or perhaps spring snowmelt.&lt;/p&gt;

&lt;p&gt;In many circumstances it would make sense to non-dimensionalize the equation at this point, but for practical purposes it can be convenient to retain physical units. (For example, the task could be to find the response to an observed time series &lt;em&gt;F=F(t)&lt;/em&gt; of forcing.)&lt;/p&gt;

&lt;p&gt;Expressing the model as $$\frac{dh}{dt} = \frac{F-\gamma h}{A}$$ is helpful since this is a form that works well with &lt;code&gt;lsoda()&lt;/code&gt;, the R function to be used here to carry out the numerical integration of the differential equation.&lt;/p&gt;

&lt;h1 id=&quot;solution_in_r&quot;&gt;Solution in R&lt;/h1&gt;

&lt;p&gt;The first step is to load the package containing &lt;code&gt;lsoda()&lt;/code&gt;.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;deSolve&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Readers who are following along might want to type &lt;code&gt;?lsoda&lt;/code&gt; in an R console at this point, to get an idea of the reasoning being followed here. The summary is that &lt;code&gt;lsoda()&lt;/code&gt; takes initial conditions as its first argument, a vector of times at which to report the solution as its second argument, a function defining the differential equation(s) as its third argument, and a list containing model parameters in its fourth argument.&lt;/p&gt;

&lt;p&gt;We start by defining initial conditions, in line 1. In this case, suppose that &lt;code&gt;h=0&lt;/code&gt;, i.e. that the lake water level is equal to that of the sea. Then, in line 2, we set parameters. This is at the heart of the matter, and will be the most important part of any application of such a model. Here, we take simple values: square lake of width 1 km (&lt;code&gt;A&lt;/code&gt;=10^6 m^2), and outflow coefficient &lt;code&gt;gamma=&lt;/code&gt;10 m^2/s.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;IC &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
parms &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; list&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;A &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1e+06&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; gamma &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Suppose we would like to examine the result of riverine input &lt;code&gt;F&lt;/code&gt; of 1m^3/s lasting for a day, so that it makes sense to set up a time vector of, say, a week.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;sperday &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;86400&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# seconds per day&lt;/span&gt;
times &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sperday&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;k-Variable&#39;&gt;F&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; sperday &lt;span class=&#39;o&#39;&gt;&amp;amp;&lt;/span&gt; t &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sperday&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;(The length of &lt;code&gt;times&lt;/code&gt; mainly matters to plotting; it has no effect on the accuray of the solution, i.e. we are not setting an integration time step here.)&lt;/p&gt;

&lt;p&gt;Next, set up the differential equation. This has to follow a certain format. The function must take time as first argument, current model state (a vector, generally) as second, and parameters, third. The function returns a list of derivatives.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;DE &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; parms&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    h &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
    dhdt &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k-Variable&#39;&gt;F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; parms&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;gamma &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; h&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;parms&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;A
    list&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;dhdt&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Here, the state is extracted into a variable named &lt;code&gt;h&lt;/code&gt; and the derivative is stored in a variable named &lt;code&gt;dhdt&lt;/code&gt;. This is done merely for clarity of illustration here; experienced programmers are likely to write &lt;code&gt;DE&lt;/code&gt; as a single-line function.&lt;/p&gt;

&lt;p&gt;Computing the model solution is now easy:&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;sol &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; lsoda&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;IC&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; times&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; DE&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; parms&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;defines &lt;code&gt;sol&lt;/code&gt;, which has time as its first column and the solution as its second. We may plot the results as follows (where time is indicated in days for simplicity).&lt;/p&gt;

&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
h &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; sol&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
Day &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; times&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;86400&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Day&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;k-Variable&#39;&gt;F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;times&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;River input [m^3/s]&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Day&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; h&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Lake level [m]&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-03-16-box-model.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;Those interested in box models might like to alter the parameters and forcing function, to study the results.&lt;/p&gt;

&lt;p&gt;Adding more boxes is easy, and a good exercise for the reader. Careful adjustment of parameters in multi-box models can yield reasonably useful alternatives to high-resolution numerical models, especially for exploratory work.&lt;/p&gt;

&lt;p&gt;It is also a simple matter to change the forcing and the model formulation. For example, the outflow function could be made nonlinear, e.g. to account for hydraulic-control effects. Adding time dependence to parameterizations is not difficult either, and it opens the possibility of using such models in wide applications, e.g. modelling dam-break situations.&lt;/p&gt;

&lt;p&gt;At a more advanced level, one can also use such a model in a data-assimilative way to infer parameter values from observations of quantities predicted by the model. For example, if &lt;em&gt;F&lt;/em&gt; were known for a given lake (and of course its area known also) then observations of lake level could yield a value of &lt;code&gt;gamma&lt;/code&gt; as formulated here, or could suggest another formulation for lake outflow.&lt;/p&gt;

&lt;p&gt;As mathematically-inclined readers might agree, and others might learn by a bit of exploration, numerical experimentation can be a useful tool for increasing understanding.&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/assets/2014-03-16-box-model.R&quot;&gt;R code used in this blog item&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;https://raw.github.com/dankelley/dankelley.github.io/master/assets/2014-03-16-box-model.Rmd&quot;&gt;Jekyll source code for this blog item&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>Digitizing plots</title>
   <link href="http://dankelley.github.io/blog//r/2014/03/12/digitizing-plots.html"/>
   <updated>2014-03-12T00:00:00-03:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/03/12/digitizing-plots</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;It is not uncommon to want to digitize values from a graph in a paper, whether to do some initial analysis without bothering an author, or to get data from a paper published so long ago that the data are available only graphically. Although there are several software applications that do this well, it is also possible to use the &lt;code&gt;locator()&lt;/code&gt; function of R. This posting shows how to do that.&lt;/p&gt;

&lt;h1 id=&quot;method&quot;&gt;Method&lt;/h1&gt;

&lt;p&gt;Code for digitizing a plot on the screen is given below, without comment. It can be saved to a file, for later use. (I don’t bother commenting because the work of doing that is about equal to the work of making a package, which I may do, if anyone expresses interest.)&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;xaxis &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    message&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;click on the x axis at places where x=&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; paste&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; collapse &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; 
        &lt;span class=&#39;s&#39;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; locator&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    m &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; lm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values &lt;span class=&#39;o&#39;&gt;~&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    C &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coef&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;m&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    xa &lt;span class=&#39;o&#39;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; C&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
    xb &lt;span class=&#39;o&#39;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; C&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
yaxis &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    message&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;click on the y axis at places where x=&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; paste&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; collapse &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; 
        &lt;span class=&#39;s&#39;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; locator&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    m &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; lm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;values &lt;span class=&#39;o&#39;&gt;~&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    C &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coef&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;m&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    ya &lt;span class=&#39;o&#39;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; C&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
    yb &lt;span class=&#39;o&#39;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; C&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
topright &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    message&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;click the top-right corner of plot box\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; locator&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    xout &lt;span class=&#39;o&#39;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x
    yout &lt;span class=&#39;o&#39;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
data &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    message&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;escape by clicking to right of or above top-right corner of box\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
    i &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;while&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; locator&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        xx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; xa &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; xb &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x
        yy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ya &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; yb &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y
        cat&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;i=&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; i&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;xy:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;-&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; yy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; xout &lt;span class=&#39;o&#39;&gt;||&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; yout&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
            &lt;span class=&#39;kr&#39;&gt;return&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;list&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
        &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
        x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xx&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; yy&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        i &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; i &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
        &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;i &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; 
            &lt;span class=&#39;kr&#39;&gt;return&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;list&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
digitize &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;image&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xaxis&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; yaxis&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;png&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    png &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; readPNG&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;image&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    rasterImage&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;png&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    xaxis&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xaxis&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    yaxis&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;yaxis&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    topright&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
    data&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;application&quot;&gt;Application&lt;/h1&gt;

&lt;p&gt;As a test of this, let’s create some fake data&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;set.seed&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;123&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; rnorm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;o&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-03-12-make-data.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;and digitize the resultant image (saved in a PNG file).&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; digitize&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;sample.png&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;When I did as above, clicking points without a great deal of care, I got an RMS error of a bit under 2 percent. It seems likely that more careful work could get this closer to 1 percent.&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;This method is perhaps slightly easier than hand-rolling new code for each instance of this task. It lacks some basic features, however. One nice addition would be the ability to remove data points. For that, perhaps the lower-left corner of the graph box could be determined with a function named &lt;code&gt;bottomleft()&lt;/code&gt;, and the rule could be that clicking below that point or to its left would remove the most recent point. That’s an exercise for the reader. Possibly the next step would be to take the hour it would take to create a little package … although it seems likely that one already exists!&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-03-12-digitizing-plots.R&quot;&gt;2014-03-12-digitizing-plots.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>Error bars in R</title>
   <link href="http://dankelley.github.io/blog//r/2014/03/05/error-bars-in-r.html"/>
   <updated>2014-03-05T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/03/05/error-bars-in-r</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Error propagation can be a fair bit of work with a calculator, but it’s easy with R. Just use R in repeated calculation with perturbed quantities, and inspect the range of results. Two methods are shown below for inspecting the range: &lt;code&gt;sd()&lt;/code&gt; and &lt;code&gt;quantile()&lt;/code&gt;, the latter using the fact that area under a normal distribution is 0.68 when calculated between -1 and 1 standard deviation.&lt;/p&gt;

&lt;h1 id=&quot;tests&quot;&gt;Tests&lt;/h1&gt;

&lt;h2 id=&quot;case_1_scale_factor&quot;&gt;Case 1: scale factor&lt;/h2&gt;

&lt;p&gt;In this case, the answer is simple. If &lt;code&gt;A&lt;/code&gt; has uncertainty equal to 0.1, then &lt;code&gt;10A&lt;/code&gt; has uncertainty 1.0.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;set.seed&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;123&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;500&lt;/span&gt;
result &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; vector&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;double&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
A &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
Au &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# uncertainty in A&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;i &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    Ap &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; A &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Au &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; rnorm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    result&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; Ap
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
D &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.68&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
r &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; quantile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; probs &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;D&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; D&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
cat&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;value:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;uncertainty:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sd&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot; range:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; r&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;to&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    r&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## value: 10.03 uncertainty: 0.9728  range: 9.047 to 11.02
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;hist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/figs/2014-03-05-error-bars-in-r/unnamed-chunk-1.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The graph indicates that the values are symmetric, which makes sense for a linear operation.&lt;/p&gt;

&lt;h2 id=&quot;case_2_squaring&quot;&gt;Case 2: squaring&lt;/h2&gt;

&lt;p&gt;Here, we expect an uncertainty of 20 percent.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;set.seed&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;123&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;500&lt;/span&gt;
result &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; vector&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;double&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
A &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
Au &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# uncertainty in A&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;i &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    Ap &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; A &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Au &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; rnorm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    result&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; Ap&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
D &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.68&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
r &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; quantile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; probs &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;D&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; D&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
cat&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;value:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;uncertainty:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sd&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot; range:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; r&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;to&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    r&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## value: 1.016 uncertainty: 0.1965  range: 0.8184 to 1.213
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;hist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/figs/2014-03-05-error-bars-in-r/unnamed-chunk-2.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;case_3_a_nonlinear_function&quot;&gt;Case 3: a nonlinear function&lt;/h2&gt;

&lt;p&gt;Here, we have a hyperbolic tangent, so the expected error bar will be trickier analytically, but of course the R method remains simple. (Note that the uncertainty is increased to ensure a nonlinear range of hyperbolic tangent.)&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;set.seed&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;123&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;500&lt;/span&gt;
result &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; vector&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;double&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
A &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
Au &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# uncertainty in A&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;i &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    Ap &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; A &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Au &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; rnorm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    result&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; tanh&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Ap&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
D &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.68&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
r &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; quantile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; probs &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;D&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; D&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
cat&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;value:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;uncertainty:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sd&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot; range:&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; r&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;to&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    r&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## value: 0.7009 uncertainty: 0.233  range: 0.4803 to 0.9065
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;hist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;result&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/figs/2014-03-05-error-bars-in-r/unnamed-chunk-3.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;The computation is a simple matter of looping over a perturbed calculation. Here, gaussian errors are assumed, but other distributions could be used (e.g. quantities like kinetic energy that cannot be distributed in a Gaussian manner).&lt;/p&gt;

&lt;h1 id=&quot;further_work&quot;&gt;Further work&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;How large should &lt;code&gt;n&lt;/code&gt; be, to get results to some desired resolution?&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;If the function is highly nonlinear, perhaps the &lt;code&gt;mean(result)&lt;/code&gt; should be replaced by &lt;code&gt;median(result)&lt;/code&gt;, or something.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;R source code: &lt;a href=&quot;/assets/2014-03-05-error-bars-in-r.R&quot;&gt;2014-03-05-error-bars-in-r.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>Oce translations</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/26/oce-translations.html"/>
   <updated>2014-02-26T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/26/oce-translations</id>
   <content type="html">&lt;p&gt;A new Oce user wondered how to get Spanish labels on axes. This is easy for some plot types because &lt;code&gt;xlab&lt;/code&gt; and &lt;code&gt;ylab&lt;/code&gt; arguments are obeyed, but in many cases the labels are generated by the code. That meant that it was finally time for me to start localizing Oce, using the &lt;a href=&quot;http://www.gnu.org/software/gettext/&quot;&gt;GNU gettext&lt;/a&gt; scheme. Gettext being unfamiliar to me, I stumbled a bit at first, and decided to document the procedure here.&lt;/p&gt;

&lt;p&gt;The start of this blog post is mostly for me, while the end is mostly for users who would like to help in the translation effort.&lt;/p&gt;

&lt;h1 id=&quot;part_1_developer_notes&quot;&gt;PART 1: developer notes&lt;/h1&gt;

&lt;h2 id=&quot;initial_work_cycle&quot;&gt;Initial work cycle&lt;/h2&gt;

&lt;h3 id=&quot;step_1&quot;&gt;Step 1&lt;/h3&gt;

&lt;p&gt;Create a directory named &lt;code&gt;oce/po/&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;step_2&quot;&gt;Step 2&lt;/h3&gt;

&lt;p&gt;The basic procedure it to change a code fragment like&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Depth&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;which is clearly not appropriate in all langauges, into&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;gettext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Depth&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; domain&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;R-oce&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;which yields an entry in a translation table that can then be tailored for any desired language. (The &lt;code&gt;gettext()&lt;/code&gt; call should not really need to set the &lt;code&gt;domain&lt;/code&gt;, but I found it necessary for some items, and decided to include it everywhere.)&lt;/p&gt;

&lt;h3 id=&quot;step_3&quot;&gt;Step 3&lt;/h3&gt;

&lt;p&gt;Enter the &lt;code&gt;oce&lt;/code&gt; directory, launch R, and type as follows, to insert a file named &lt;code&gt;R-oce.pot&lt;/code&gt; in the &lt;code&gt;po&lt;/code&gt; directory.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;tools&lt;span class=&#39;o&#39;&gt;::&lt;/span&gt;update_pkg_po&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;This create a file that has entries for all errors, warnings, and messages, as well as for &lt;code&gt;gettext()&lt;/code&gt; entries. The file will be named &lt;code&gt;po/R-oce.pot&lt;/code&gt;, and will contain entry pairs such as the following.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;msgid &lt;span class=&#39;s2&#39;&gt;&amp;quot;Depth&amp;quot;&lt;/span&gt;
msgstr &lt;span class=&#39;s2&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;The first of these is a key, and the second is a replacement string (discussed presently). The details of the file format, and much else relating to &lt;code&gt;gettext&lt;/code&gt; are available at the &lt;a href=&quot;http://www.gnu.org/software/gettext/manual/gettext.html&quot;&gt;GNU site&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;step_4&quot;&gt;Step 4&lt;/h3&gt;

&lt;p&gt;To start work on, say, a French translation table, type the following in the shell.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;nb&#39;&gt;cd &lt;/span&gt;oce/po
msginit --locale&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;R-fr --input R-oce.pot
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;This creates an English-French translation table in a file named &lt;code&gt;po/R-fr.po&lt;/code&gt;. This must be done just once for each language to be translated. The key is the &lt;code&gt;fr&lt;/code&gt; part of the name, which is the &lt;a href=&quot;http://en.wikipedia.org/wiki/ISO_639&quot;&gt;ISO-639&lt;/a&gt; code for French.&lt;/p&gt;

&lt;p&gt;Once the file is created, look at it with a text editor and, if necessary, change the &lt;code&gt;charset&lt;/code&gt; to &lt;code&gt;UTF-8&lt;/code&gt;, which can handle most languages.&lt;/p&gt;

&lt;p&gt;Importantly, running &lt;code&gt;msginit&lt;/code&gt; is only necessary at the first stage of translation. As new entries are added, one must only follow the work cycle given below.&lt;/p&gt;

&lt;h3 id=&quot;step_5&quot;&gt;Step 5&lt;/h3&gt;

&lt;p&gt;Edit &lt;code&gt;po/R-fr.po&lt;/code&gt; as desired, inserting translations. You will need a text editor that permits characters in a variety of languages; vim and emacs are ideal for this.&lt;/p&gt;

&lt;p&gt;Simply change the &lt;code&gt;msgstr&lt;/code&gt; item to the translated value, e.g. for French the &lt;code&gt;R-fr.po&lt;/code&gt; file should contain&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;msgid &lt;span class=&#39;s2&#39;&gt;&amp;quot;Depth&amp;quot;&lt;/span&gt;
msgstr &lt;span class=&#39;s2&#39;&gt;&amp;quot;Profondeur&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;for this entry.&lt;/p&gt;

&lt;h2 id=&quot;update_work_cycle&quot;&gt;Update work cycle&lt;/h2&gt;

&lt;p&gt;The work cycle is as follows.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Edit the R source code, replacing strings like &lt;code&gt;FOO&lt;/code&gt; with &lt;code&gt;gettext(&amp;quot;FOO&amp;quot;, &amp;quot;R-oce&amp;quot;)&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Launch R in the &lt;code&gt;oce&lt;/code&gt; directory and invoke &lt;code&gt;tools::update_pkg_po(&amp;quot;.&amp;quot;)&lt;/code&gt; to add an entry to the &lt;code&gt;po/R-oce.pot&lt;/code&gt; file, with corresponding entries in &lt;code&gt;po/R-fr.po&lt;/code&gt; and any other existing translation files.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Edit &lt;code&gt;po/R-fr.po&lt;/code&gt; and any other translation files, changing the &lt;code&gt;msgstr&lt;/code&gt; entry that corresponds to &lt;code&gt;FOO&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Run &lt;code&gt;tools::update_pkg_po(&amp;quot;.&amp;quot;)&lt;/code&gt; again, to update all relevant files in the &lt;code&gt;inst&lt;/code&gt; directory.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Build and test oce.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Repeat from step 1 as required for other words.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Since step 5 is slow, it helps to be watching your country win a gold medal in the Olympics hockey game, while you are doing such work.&lt;/p&gt;

&lt;h2 id=&quot;using_translations&quot;&gt;Using translations&lt;/h2&gt;

&lt;p&gt;In most cases the system language will be set with system tools. Still, &lt;code&gt;Sys.setenv()&lt;/code&gt; can be handy for switching the language used in a plot (e.g. a French user may have the computer set up to work in French, but may prefer to graph data using English, for publication). Commonly, &lt;code&gt;Sys.setenv()&lt;/code&gt; will be done in the R startup file, or defined in the OS shell, e.g. below for a temporary use&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;nv&#39;&gt;LANG&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;es_ES.UTF-8 R --no-save &amp;lt; spanish.R
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;part_2_helping_me_with_the_translation_effort&quot;&gt;PART 2: Helping me with the translation effort&lt;/h1&gt;

&lt;p&gt;At the moment, Oce works in English, with some support for Spanish, French and German. The support for Mandarin is crude, having come from online translation engines.&lt;/p&gt;

&lt;p&gt;If you would like Oce graphs to work in another language with which you have high familiarity, please contact me. I will need you to write down a few relevant words in your language and send them to me via PDF or scanned hand-written document (MSword and OpenOffice formats cannot are not useful). Minimally, the words should be the ones used on axes of the graphs you use, but it would help other users if you could translate the phrases listed below. Also, translate &lt;code&gt;E&lt;/code&gt;, &lt;code&gt;W&lt;/code&gt;, &lt;code&gt;N&lt;/code&gt;, and &lt;code&gt;S&lt;/code&gt;, as used in longitude and latitude, as well as any other unit abbreviations that differ between English and your language.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;Absolute Salinity
Conservative Temperature
Depth
Distance
Elevation
Longitude
Latitude
Potential Temperature
Potential Density Anomaly
Practical Salinity
Pressure
Sea Level
Speed
Temperature
Velocity
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;The easiest way to provide translated items is in a UTF-8 file containing translated phrases that I can copy and paste into the source files.&lt;/p&gt;

&lt;h2 id=&quot;table_of_results&quot;&gt;Table of results&lt;/h2&gt;

&lt;p&gt;The following code demonstrates translations by default plots for various data types. Mandarin requires a font-family specification. The Mandarin translations came from online engines and may be laughably bad.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
datasets &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;adv&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;adp&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;cm&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;ctd&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;drifter&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;lisst&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;lobo&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;sealevel&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;section&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;tdr&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
languages &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;en&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;es&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;de&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;fr&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;zh&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; datasets&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;list&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;d&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;section&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        section &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; sectionGrid&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;section&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;l &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; languages&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        pdf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;paste&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;-&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;.pdf&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;sep&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; family&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;l&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;zh&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;GB1&amp;quot;&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Helvetica&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        Sys.setenv&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;LANGUAGE&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;get&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
        dev.off&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;To make the above work, an up-to-date version of the &lt;code&gt;translation&lt;/code&gt; branch must be installed, by executing the following in R:&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;devtools&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
install_github&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;ocedata&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;dankelley&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;master&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
install_github&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;oce&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;dankelley&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;languages&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;The results of the test code given above are shown below (click to enlarge).&lt;/p&gt;

&lt;h3 id=&quot;english&quot;&gt;English&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/assets/adp-en.png&quot;&gt;&lt;img src=&quot;/assets/adp-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/adv-en.png&quot;&gt;&lt;img src=&quot;/assets/adv-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/cm-en.png&quot;&gt;&lt;img src=&quot;/assets/cm-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/ctd-en.png&quot;&gt;&lt;img src=&quot;/assets/ctd-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/drifter-en.png&quot;&gt;&lt;img src=&quot;/assets/drifter-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lisst-en.png&quot;&gt;&lt;img src=&quot;/assets/lisst-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lobo-en.png&quot;&gt;&lt;img src=&quot;/assets/lobo-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/sealevel-en.png&quot;&gt;&lt;img src=&quot;/assets/sealevel-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/section-en.png&quot;&gt;&lt;img src=&quot;/assets/section-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/tdr-en.png&quot;&gt;&lt;img src=&quot;/assets/tdr-en-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;french&quot;&gt;French&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/assets/adp-fr.png&quot;&gt;&lt;img src=&quot;/assets/adp-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/adv-fr.png&quot;&gt;&lt;img src=&quot;/assets/adv-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/cm-fr.png&quot;&gt;&lt;img src=&quot;/assets/cm-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/ctd-fr.png&quot;&gt;&lt;img src=&quot;/assets/ctd-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/drifter-fr.png&quot;&gt;&lt;img src=&quot;/assets/drifter-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lisst-fr.png&quot;&gt;&lt;img src=&quot;/assets/lisst-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lobo-fr.png&quot;&gt;&lt;img src=&quot;/assets/lobo-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/sealevel-fr.png&quot;&gt;&lt;img src=&quot;/assets/sealevel-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/section-fr.png&quot;&gt;&lt;img src=&quot;/assets/section-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/tdr-fr.png&quot;&gt;&lt;img src=&quot;/assets/tdr-fr-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;german&quot;&gt;German&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/assets/adp-de.png&quot;&gt;&lt;img src=&quot;/assets/adp-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/adv-de.png&quot;&gt;&lt;img src=&quot;/assets/adv-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/cm-de.png&quot;&gt;&lt;img src=&quot;/assets/cm-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/ctd-de.png&quot;&gt;&lt;img src=&quot;/assets/ctd-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/drifter-de.png&quot;&gt;&lt;img src=&quot;/assets/drifter-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lisst-de.png&quot;&gt;&lt;img src=&quot;/assets/lisst-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lobo-de.png&quot;&gt;&lt;img src=&quot;/assets/lobo-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/sealevel-de.png&quot;&gt;&lt;img src=&quot;/assets/sealevel-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/section-de.png&quot;&gt;&lt;img src=&quot;/assets/section-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/tdr-de.png&quot;&gt;&lt;img src=&quot;/assets/tdr-de-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;mandarin&quot;&gt;Mandarin&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/assets/adp-zh.png&quot;&gt;&lt;img src=&quot;/assets/adp-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/adv-zh.png&quot;&gt;&lt;img src=&quot;/assets/adv-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/cm-zh.png&quot;&gt;&lt;img src=&quot;/assets/cm-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/ctd-zh.png&quot;&gt;&lt;img src=&quot;/assets/ctd-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/drifter-zh.png&quot;&gt;&lt;img src=&quot;/assets/drifter-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lisst-zh.png&quot;&gt;&lt;img src=&quot;/assets/lisst-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/lobo-zh.png&quot;&gt;&lt;img src=&quot;/assets/lobo-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/sealevel-zh.png&quot;&gt;&lt;img src=&quot;/assets/sealevel-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/section-zh.png&quot;&gt;&lt;img src=&quot;/assets/section-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt; &lt;a href=&quot;/assets/tdr-zh.png&quot;&gt;&lt;img src=&quot;/assets/tdr-zh-thumbnail.png&quot; alt=&quot;tg&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://developer.r-project.org/Translations30.html&quot;&gt;R documentation on translation methodology&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://www.gnu.org/software/gettext/&quot;&gt;GNU documentation on gettext&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>Improved filtfilt() for R</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/19/filtfilt.html"/>
   <updated>2014-02-19T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/19/filtfilt</id>
   <content type="html">&lt;p&gt;The &lt;code&gt;filtfilt&lt;/code&gt; function in R is supposedly based on the Matlab one, but it does quite badly on endpoints. My goal here is to explore alternatives, with a focus on the Octave method.&lt;/p&gt;

&lt;p&gt;NOTE: I may also try &lt;a href=&quot;http://wiki.scipy.org/Cookbook/FiltFilt&quot;&gt;scipy&lt;/a&gt; for hints.)&lt;/p&gt;

&lt;p&gt;The best method of dealing with endpoints is still an open question. Matlab does one thing, Octave does another. Both seem to work reasonably well, and the Octave license is more appropriate to the present task, so I am focussing on that.&lt;/p&gt;

&lt;p&gt;This is a page in progress. I am trying to make some of my R code work exactly as Octave does, since then I’ll know that I’ve successfully mimicked their method. This is proving to be difficult! I started this page weeks ago and have returned to it several times. If/when I figure it out, I will update the date of the blog posting and remove the “draft” designation.&lt;/p&gt;

&lt;p&gt;If any readers have ideas, please let me know!&lt;/p&gt;

&lt;h1 id=&quot;octave_implementation&quot;&gt;Octave implementation&lt;/h1&gt;

&lt;h2 id=&quot;full_code_with_initial_comments_removed_for_brevity&quot;&gt;Full code (with initial comments removed for brevity)&lt;/h2&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;matlab&#39;&gt;&lt;span class=&#39;k&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;w&#39;&gt; &lt;/span&gt;y &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;w&#39;&gt; &lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;filtfilt&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b, a, x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;w&#39; /&gt;

&lt;span class=&#39;w&#39;&gt;  &lt;/span&gt;&lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;nargin&lt;/span&gt; !&lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;print_usage&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;endif&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;rotate&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;size&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;rotate&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;                    # &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;row&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;vector&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(:);&lt;/span&gt;                   # &lt;span class=&#39;n&#39;&gt;make&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;it&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;column&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;vector&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;endif&lt;/span&gt;

  &lt;span class=&#39;n&#39;&gt;lx&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;size&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(:).&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;;&lt;/span&gt;
&lt;span class=&#39;s&#39;&gt;  b = b(:).&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;lb&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;length&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;la&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;length&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;n&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;max&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;lb&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;la&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;lrefl&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;n&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;la&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;n&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;n&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;endif&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;lb&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;n&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;n&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;endif&lt;/span&gt;

  ## &lt;span class=&#39;n&#39;&gt;Compute&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;the&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;initial&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;state&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;taking&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;inspiration&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;from&lt;/span&gt;
  ## &lt;span class=&#39;n&#39;&gt;Likhterov&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;Kopeika&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;2003.&lt;/span&gt; &amp;quot;&lt;span class=&#39;n&#39;&gt;Hardware&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;efficient&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;technique&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt;
  ##     &lt;span class=&#39;n&#39;&gt;minimizing&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;startup&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;transients&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;Direct&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;Form&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;II&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;digital&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filters&lt;/span&gt;&amp;quot;
  &lt;span class=&#39;n&#39;&gt;kdc&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sum&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sum&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;abs&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;kdc&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;inf&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; # &lt;span class=&#39;n&#39;&gt;neither&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;NaN&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;nor&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+/-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;Inf&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;si&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;fliplr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cumsum&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;fliplr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;kdc&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)));&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;si&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;zeros&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;size&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt; # &lt;span class=&#39;n&#39;&gt;fall&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;back&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;to&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;zero&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;initialization&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;endif&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;si&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[];&lt;/span&gt;

  &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;c&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;size&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; # &lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;all&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;columns&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;one&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;by&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;one&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;c&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;((&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;lrefl&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;c&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(:,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;c&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
         &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;end&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;c&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;((&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;end&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;end&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;lrefl&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;c&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)];&lt;/span&gt; # &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;column&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;vector&lt;/span&gt;

    ## &lt;span class=&#39;n&#39;&gt;Do&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;forward&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;and&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;reverse&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filtering&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;si&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt;                   # &lt;span class=&#39;n&#39;&gt;forward&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;flipud&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;flipud&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;si&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;end&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)));&lt;/span&gt; # &lt;span class=&#39;n&#39;&gt;reverse&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(:,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;c&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;((&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;lrefl&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;lx&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;lrefl&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;endfor&lt;/span&gt;

  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;rotate&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;                   # &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;was&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;row&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;vector&lt;/span&gt;
    &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;rot90&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;               # &lt;span class=&#39;n&#39;&gt;rotate&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;it&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;back&lt;/span&gt;
  &lt;span class=&#39;n&#39;&gt;endif&lt;/span&gt;

&lt;span class=&#39;n&#39;&gt;endfunction&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;test&quot;&gt;Test&lt;/h2&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;matlab&#39;&gt;&lt;span class=&#39;n&#39;&gt;pkg&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;load&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;signal&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]=&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;butter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;                  # &lt;span class=&#39;mi&#39;&gt;10&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;Hz&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;low&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pass&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt;
&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;mf&#39;&gt;0.01&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;mf&#39;&gt;1.0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;                         # &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;second&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sample&lt;/span&gt;
&lt;span class=&#39;n&#39;&gt;load&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;dat&lt;/span&gt; # &lt;span class=&#39;n&#39;&gt;created&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;by&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;the&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;R&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;code&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;to&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;ensure&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;both&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;have&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;same&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;data&lt;/span&gt;
&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filtfilt&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;z&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;b&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;a&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; # &lt;span class=&#39;n&#39;&gt;apply&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;filter&lt;/span&gt;
&lt;span class=&#39;n&#39;&gt;plot&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;;data;&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;;filtfilt;&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;z&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;;filter;&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;/assets/2014-02-19-filtfilt_octave.png&quot;&gt;&lt;img src=&quot;/assets/2014-02-19-filtfilt_octave-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;r_implementation&quot;&gt;R implementation&lt;/h1&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;ab &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; signal&lt;span class=&#39;o&#39;&gt;::&lt;/span&gt;butter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.01&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; scan&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;x.dat&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## below could be extracted to a function when working&lt;/span&gt;
a &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ab&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;a
b &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ab&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;b
na &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;a&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
nb &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
kdc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; sum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;sum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;a&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;is.nan&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;kdc&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    si &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; rev&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;cumsum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rev&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; kdc &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; a&lt;span class=&#39;p&#39;&gt;)))&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    si &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;a&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
lx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
si &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; si&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
nx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;na&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; nb&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lrefl &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;na &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; a &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;a&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; n &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; na&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;nb &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; b &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; n &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; nb&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
v &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;seq.int&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lrefl &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)],&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;nx&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;seq.int&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;nx &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; 
    &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; nx &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; lrefl&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)])&lt;/span&gt;
v_before_first_filter &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;# v &amp;lt;- signal::filter(b, a, v, init.x=si*v[1]) # forward filter (WRONG&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;# OUTPUT)&lt;/span&gt;
si_v1 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; si &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;# v &amp;lt;- signal::filter(b, a, v, init=si*v[1]) # forward filter (WRONG OUTPUT)&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;# v &amp;lt;- signal::filter(b, a, v, init.x=si*v[1]) # forward filter (WRONG&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;# OUTPUT) v &amp;lt;- signal::filter(b, a, v, init.y=si*v[1]) # forward filter&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;# (WRONG OUTPUT) v &amp;lt;- signal::filter(b, a, v, init.x=si*v[1]) # forward&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;# filter (WRONG OUTPUT)&lt;/span&gt;
v &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; stats&lt;span class=&#39;o&#39;&gt;::&lt;/span&gt;filter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; a&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; init &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; si &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# forward filter (WRONG OUTPUT)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Error: &amp;#39;arg&amp;#39; must be NULL or a character vector
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;v_after_first_filter &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;

si_vend &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; si &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;v&lt;span class=&#39;p&#39;&gt;)]&lt;/span&gt;
v &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; rev&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;signal&lt;span class=&#39;o&#39;&gt;::&lt;/span&gt;filter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; a&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rev&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;v&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; init.x &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; si &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;v&lt;span class=&#39;p&#39;&gt;)]))&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# reverse filter&lt;/span&gt;
v_after_first_filter &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; v&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;seq.int&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lrefl &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lx &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; lrefl&lt;span class=&#39;p&#39;&gt;)]&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/figs/2014-02-19-filtfilt/unnamed-chunk-1.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;comparison_between_r_and_octave_output&quot;&gt;Comparison between R and octave output&lt;/h1&gt;

&lt;p&gt;The test codes &lt;a href=&quot;/assets/a_m.html&quot;&gt;a.m&lt;/a&gt; and &lt;a href=&quot;/assets/a_R.html&quot;&gt;a.R&lt;/a&gt; are the basis for the above.&lt;/p&gt;

&lt;p&gt;Some R values (and comparisons with octave output) are given below.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;si&lt;/code&gt;: 0.9971, -1.3857, 0.535 (expect 0.99710 -1.38569 0.53497)&lt;/li&gt;

&lt;li&gt;&lt;code&gt;lrefl&lt;/code&gt;: 9 (expect 9)&lt;/li&gt;

&lt;li&gt;&lt;code&gt;si_v1&lt;/code&gt;: -1.1293, 1.5694, -0.6059&lt;code&gt; (expect -1.12926   1.56935  -0.60588)&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;&lt;code&gt;si_vend&lt;/code&gt;: 0.8557, -1.1891, 0.4591&lt;code&gt; (expect 0.65164  -0.90559   0.34962)&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;&lt;code&gt;v_before_first_filter&lt;/code&gt;: -1.1325, -1.0238, -0.8117, -1.1579 (expect -1.132546 -1.023766 -0.811650 -1.157909 -1.370316 -0.858954 -0.717951 …)&lt;/li&gt;

&lt;li&gt;&lt;code&gt;v_after_first_filter&lt;/code&gt;: -0.6099, -0.4232, -0.219, -0.0097 (expect -1.157285 -1.123425 -1.072315 -1.001433 -0.909024 -0.794494 -0.658707 …)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Since v was ok before the filter, and wrong after, the problem seems to be in filter().&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Finding the problem may be arduous, since (a) the R function &lt;code&gt;stats::filter()&lt;/code&gt; is not well documented, regarding &lt;code&gt;init&lt;/code&gt;, &lt;code&gt;init.x&lt;/code&gt; and &lt;code&gt;init.y&lt;/code&gt;, and (b) the Octave &lt;code&gt;filter()&lt;/code&gt; spans 700 lines of C, so it is hard to reverse engineer to figure out what it’s doing.&lt;/p&gt;

&lt;h2 id=&quot;filtercc&quot;&gt;filter.cc&lt;/h2&gt;

&lt;p&gt;I’ll start by assuming that this is trying to mimic the Matlab function of the same name, although the 4th arg is called &lt;code&gt;si&lt;/code&gt; in Octave and &lt;code&gt;zi&lt;/code&gt; in Matlab, so some caution is warranted.&lt;/p&gt;

&lt;p&gt;The docs on the matlab version are &lt;a href=&quot;http://www.mathworks.com/help/matlab/ref/filter.html&quot;&gt;here&lt;/a&gt; 1. it takes 4 args, the last of which (&lt;code&gt;si&lt;/code&gt;) is perhaps worth investigating, since it’s different from the initialization in the R filter (which has 3 items).&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;si&lt;/code&gt; gets renamed as &lt;code&gt;psi&lt;/code&gt; in line 166&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Matlab test code &lt;a href=&quot;/assets/a_m.html&quot;&gt;a.m&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;R &lt;a href=&quot;/assets/stats_filter_R.html&quot;&gt;signal::filter.R&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;R test code &lt;a href=&quot;/assets/a_R.html&quot;&gt;a.R&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;test data used by above two codes &lt;a href=&quot;/assets/x.dat&quot;&gt;x.dat&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;matlab &lt;a href=&quot;/assets/filtfilt_m_matlab.html&quot;&gt;filtfilt.m&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;the octave script &lt;a href=&quot;/assets/filtfilt_m.html&quot;&gt;filtfilt.m&lt;/a&gt; can be acquired by typing &lt;code&gt;pkg install -forge signal&lt;/code&gt; in an Octave window, and extracting file named &lt;code&gt;~/octave/signal-1.3.0/filtfilt.m&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;the octave C filtering code &lt;a href=&quot;/assets/filter_cc.html&quot;&gt;filter.cc&lt;/a&gt; is the file &lt;code&gt;libinterp/corefcn/filter.cc&lt;/code&gt; in &lt;a href=&quot;http://www.gnu.org/software/octave/download.html&quot;&gt;the Octave source&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>demodulating time series</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/17/demodulation.html"/>
   <updated>2014-02-17T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/17/demodulation</id>
   <content type="html">&lt;p&gt;This posting shows how one might perform demodulation in R. It is assumed that readers are generally familiar tith the procedure.&lt;/p&gt;

&lt;p&gt;First, create some fake data, a carrier signal with period 10, modulated over a long timescale, and with phase drifting linearly over time.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;period &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;
fc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;period
fs &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;
t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;n
AMP &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; fc &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
PH &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;50&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; t&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
noise &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; rnorm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
signal &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; AMP &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; fc &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; t &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; PH &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; signal &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; noise
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, create the base sine and cosine time-series, varying with the known frequency, and plot these.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;xc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; fc &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
xs &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; fc &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.75&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mfcol &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; fc &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-17-demodulation-signal.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Smooth the results, and infer amplitude and phase. Here, the butterworth filter parameters are smoothing more than in the Matlab &lt;code&gt;demod()&lt;/code&gt; function (reference 1).&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;w &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; fc&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;fs
&lt;span class=&#39;c1&#39;&gt;## Here, we use more smoothing&lt;/span&gt;
w &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; w&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;
filter &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; signal&lt;span class=&#39;o&#39;&gt;::&lt;/span&gt;butter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; w&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# FIXME: why extras on w?&lt;/span&gt;
xcs &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; signal&lt;span class=&#39;o&#39;&gt;::&lt;/span&gt;filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;filter&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xc&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
xss &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; signal&lt;span class=&#39;o&#39;&gt;::&lt;/span&gt;filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;filter&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xs&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
amp &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sqrt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xcs&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; xss&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
phase &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; atan2&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xcs&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xss&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Finally, show the amplitude and phase (black for supplied, red for inferred), as well as the original time series (again, black) and the reconstructed signal (red).&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.75&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mfcol &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; AMP&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; amp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; phase&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; PH&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; amp &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; fc &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; t &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; phase &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-17-demodulation-results.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Note that altering the smoothing properties alters the results somewhat. Here, more smoothing is used than in the matlab code (reference 2). For better results, it may make sense to detrend the data before filtering, as described in &lt;a href=&quot;http://dankelley.github.io/r/2014/01/11/smoothing-hydrographic-profiles.html&quot;&gt;a previous blog item&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Source code: &lt;a href=&quot;/assets/2014-02-17-demodulation.R&quot;&gt;2014-04-17-demodulation.R&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://www.mathworks.com/help/signal/ref/demod.html&quot;&gt;Matlab demod() documentation&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</content>
 </entry>
 
 <entry>
   <title>Valentines-day full moon</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/13/valentine-moon.html"/>
   <updated>2014-02-13T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/13/valentine-moon</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;A wise person told me that it will be a full moon on the upcoming Valentine’s Day, but that it will be a long time until another one. I decided to check this with astronomical calculation.&lt;/p&gt;

&lt;h1 id=&quot;procedure&quot;&gt;Procedure&lt;/h1&gt;

&lt;p&gt;The Oce package has a function called &lt;code&gt;moonAngle()&lt;/code&gt; that returns, among other things, the illuminated fraction of the moon visible at any given time. This can be used to test for a full moon on Valentine’s day.&lt;/p&gt;

&lt;p&gt;The first step is to construct the times of Valentine’s days, starting with the one this year. Then the illuminated fraction can be calculated (here, for Halifax, the lover’s capital of Canada), and that fraction can be plotted for each of the next fifty years, with red dots for the romantic times, and blue ones for the so-sad ones.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;times &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2014-02-14&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;50&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; by &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;year&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Loading required package: methods
## Loading required package: mapproj
## Loading required package: maps
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;fraction &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; moonAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;times&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-63&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;43&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;illuminatedFraction
full &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; fraction &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.99&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;times&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; fraction&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xlab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Year&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Moon Illuminated Fraction&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;full&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;16&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-13-valentines.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here, red has been used to indicate years with full moon on Valentine’s Day, and sad blue otherwise.&lt;/p&gt;

&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;Yes, it will be a long time until the next full moon on Valentine’s Day:&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;times&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;full&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## [1] &amp;quot;2014-02-14 AST&amp;quot; &amp;quot;2033-02-14 AST&amp;quot; &amp;quot;2052-02-14 AST&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;Buy candy now.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-02-13-valentine-moon.R&quot;&gt;2014-04-13-valentine-moon.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>oce runlm function</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/11/runlm.html"/>
   <updated>2014-02-11T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/11/runlm</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;As was expected, the &lt;code&gt;runderiv()&lt;/code&gt; function has been both useful and deficient. Useful because it offers a good replacement for &lt;code&gt;smooth.spline()&lt;/code&gt; calculations of derivatives for things like N^2. And deficient because it only calculated derivatives, not values!&lt;/p&gt;

&lt;p&gt;Both an extension and a renaming were called for. The result is &lt;code&gt;runlm()&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;tests&quot;&gt;Tests&lt;/h1&gt;

&lt;p&gt;Below are the examples from its manpage, with the results.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Case 1&lt;/strong&gt;&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Loading required package: methods
## Loading required package: mapproj
## Loading required package: maps
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; x&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
yn &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; y &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; rnorm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
L &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;
calc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; runlm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; L &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; L&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deriv &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; yn&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; calc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-11-runlm-case1.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Case 2&lt;/strong&gt;&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8
9&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; which &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;N2&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
rho &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swRho&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
z &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swZ&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
zz &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
N2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-9.8&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rho&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; runlm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rho&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; zz&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deriv &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;N2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;zz&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;bottomright&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; bg &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;black&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; legend &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;swN2()&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;using runlm()&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-11-runlm-case2.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;comments&quot;&gt;Comments&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;The fit in Case 1 is almost spookily good.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;The N^2 results suggest including this as a method for &lt;code&gt;swN2()&lt;/code&gt;, perhaps the default method, but that’s for another day.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-02-11-runlm.R&quot;&gt;2014-04-11-runlm.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>oce runlm function</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/11/oce_runlm.html"/>
   <updated>2014-02-11T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/11/oce_runlm</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;As was expected, the &lt;code&gt;runderiv()&lt;/code&gt; function has been both useful and deficient. Useful because it offers a good replacement for &lt;code&gt;smooth.spline()&lt;/code&gt; calculations of derivatives for things like N^2. And deficient because it only calculated derivatives, not values!&lt;/p&gt;

&lt;p&gt;Both an extension and a renaming were called for. The result is &lt;code&gt;runlm()&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;tests&quot;&gt;Tests&lt;/h1&gt;

&lt;p&gt;Below are the examples from its manpage, with the results.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Case 1&lt;/strong&gt;&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Loading required package: methods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; x&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
yn &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; y &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; rnorm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
L &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;
calc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; runlm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; L &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; L&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deriv &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; yn&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; calc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-11-runlm-case1.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Case 2&lt;/strong&gt;&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8
9&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; which &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;N2&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
rho &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swRho&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
z &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swZ&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
zz &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
N2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-9.8&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rho&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; runlm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rho&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; zz&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deriv &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;N2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;zz&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;bottomright&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; bg &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;black&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; legend &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;swN2()&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;using runlm()&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-11-runlm-case2.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;comments&quot;&gt;Comments&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;The fit in Case 1 is almost spookily good.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;The N^2 results suggest including this as a method for &lt;code&gt;swN2()&lt;/code&gt;, perhaps the default method, but that’s for another day.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-02-11-runlm.R&quot;&gt;2014-04-11-runlm.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>oce map projection</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/10/oce-map-projection.html"/>
   <updated>2014-02-10T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/10/oce-map-projection</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Soon after map projections were added to Oce, bug reports showed that coastline plots in some projections were subject to anomalous lines that run horizontally on the plot. A ad-hoc scheme was code to try to prevent this, but it does not always work. Problems are compounded for filled coastlines.&lt;/p&gt;

&lt;p&gt;I had thought this was a basic problem of all projection coding, until I happened to try using the &lt;code&gt;projr&lt;/code&gt; package instead of &lt;code&gt;mapproj&lt;/code&gt; to carry out the projections. The result is that the annoying lines went away.&lt;/p&gt;

&lt;p&gt;I am still thinking about whether to make a transition in Oce. The &lt;code&gt;proj4&lt;/code&gt; syntax is too tricky for simple inclusion in Oce, and tricky, and users (including me) are accustomed to the existing syntax, so it would be necessary to convert the internal linkage in a somewhat nontrivial way. Nevertheless, the point of the present post is simply to illustrate that the problem is solved, at least in one test case.&lt;/p&gt;

&lt;h1 id=&quot;test_case&quot;&gt;Test case&lt;/h1&gt;

&lt;p&gt;First, load libraries and extract the coastline.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Loading required package: methods
## Loading required package: mapproj
## Loading required package: maps
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;proj4&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mapproj&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorld&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; coastlineWorld&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;longitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]&lt;/span&gt;
lat &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; coastlineWorld&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, plot with existing (mapproj) projection.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; mapproject&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorld&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;longitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; coastlineWorld&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; 
    proj &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;mollweide&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-10-projection-existing.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, plot with proposed (proj4) projection.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; project&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;cbind&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;+proj=moll&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xy&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; xy&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-10-projection-proposed.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;At least in this example, the &lt;code&gt;proj4&lt;/code&gt; package produces better coastlines, somehow being clever enough to cut the polygons that cross the “edge” of the earth.&lt;/p&gt;

&lt;p&gt;I will do some more tests to see if this is a fluke case, but if I think &lt;code&gt;proj4&lt;/code&gt; is promising, I will see how to invent a scheme for handling the &lt;code&gt;mapproj&lt;/code&gt; arguments called &lt;code&gt;parameters&lt;/code&gt; and &lt;code&gt;orientation&lt;/code&gt; with &lt;code&gt;proj4&lt;/code&gt;. THis seems to be a bit tricky, at first glance, but let’s keep the cart behind the horse for now.&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-02-10-oce-map-projection.R&quot;&gt;2014-04-10-oce-map-projection.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>N2 with runlm()</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/10/N2-runlm.html"/>
   <updated>2014-02-10T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/10/N2-runlm</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;The default &lt;code&gt;swN2()&lt;/code&gt; calculation in Oce uses a smoothing spline. One disadvantage of this is that few readers will know how it works. A possible alternative is to compute d(rho)/dz using the slope inferred from a running-window linear regression. Such a slope is provided by the new Oce function &lt;code&gt;runlm()&lt;/code&gt;, which is tested here. (Note that &lt;code&gt;runlm()&lt;/code&gt; is new enough that its argument list may change as a result of tests like the present one.)&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Loading required package: methods
## Loading required package: mapproj
## Loading required package: maps
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
rho &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swRho&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
z &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swZ&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
drhodz &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; runlm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rho&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deriv &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
g &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;9.81&lt;/span&gt;
rho0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rho&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; na.rm &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
N2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;g &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; drhodz&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;rho0
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; which &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;N2&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;N2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;bottomright&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;brown&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; legend &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;spline&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;runlm&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; bg &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-10_N2-runlm-a.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;The reuults look similar &lt;em&gt;but&lt;/em&gt; see the question below.&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;Quantitative measures could be calculated of course, but this first test suggests that the benefits of &lt;code&gt;smooth.spline()&lt;/code&gt; may be had with &lt;code&gt;runlm()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Caution.&lt;/strong&gt; &lt;code&gt;runlm()&lt;/code&gt; is still so young that its argument list and action are likely to change at any time. For example, as I was writing this posting I changes the order of the last two arguments, I made the default &lt;code&gt;window=&amp;quot;hanning&amp;quot;&lt;/code&gt;, and I changed the auto-selection of &lt;code&gt;L&lt;/code&gt;; these changes seemed more sensible for application to things like N2.&lt;/p&gt;

&lt;h1 id=&quot;what_lengthscale_to_use&quot;&gt;What lengthscale to use?&lt;/h1&gt;

&lt;p&gt;It may be helpful to determine just how well the two methods can match.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;N2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swN2&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
N2fromderiv &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;L&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;g &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; runlm&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rho&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; L &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; L&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deriv &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;rho0
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
best &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; optimize&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;L&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; sqrt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mean&lt;span class=&#39;p&#39;&gt;((&lt;/span&gt;N2 &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; N2fromderiv&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;L&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)),&lt;/span&gt; interval &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
print&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;best&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## $minimum
## [1] 6.161
## 
## $objective
## [1] 7.854e-05
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;N2best &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; N2fromderiv&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;best&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;minimum&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;This best-matching estimate is the red line.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;plotProfile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;N2&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;N2best&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ctd&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;pressure&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-10_N2-runlm-b.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;questions&quot;&gt;Questions&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;Why is there a systematic offset in the last figure?&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-02-10-N2-runlm.R&quot;&gt;2014-04-07-N2-runlm.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>N2 Runlm</title>
   <link href="http://dankelley.github.io/blog//2014/02/09/N2-runlm.html"/>
   <updated>2014-02-09T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/2014/02/09/N2-runlm</id>
   <content type="html">&lt;h2 id=&quot;n2runlma_figpath20140210__dpi100&quot;&gt;—-N2-runlm-a, fig.path=’2014-02-10_’, dpi=100————————-&lt;/h2&gt;

&lt;p&gt;library(oce) data(ctd) rho &amp;lt;- swRho(ctd) z &amp;lt;- swZ(ctd) drhodz &amp;lt;- runlm(z, rho, deriv=1) g &amp;lt;- 9.81 rho0 &amp;lt;- mean(rho, na.rm=TRUE) N2 &amp;lt;- -g * drhodz / rho0 plot(ctd, which=’N2’) lines(N2, -z, col=’blue’) legend(“bottomright”, lwd=2, col=c(“brown”, “blue”), legend=c(“spline”, “runlm”), bg=”white”)&lt;/p&gt;

&lt;h2 id=&quot;&quot;&gt;{}&lt;/h2&gt;

&lt;p&gt;N2 &amp;lt;- swN2(ctd) N2fromderiv &amp;lt;- function(L) { - g * runlm(z, rho, L=L, deriv=1) / rho0 } best &amp;lt;- optimize(function(L) sqrt(mean((N2 - N2fromderiv(L))^2)), interval=c(1, 100)) print(best) N2best &amp;lt;- N2fromderiv(best$minimum)&lt;/p&gt;

&lt;h2 id=&quot;n2runlmb_figpath20140210__dpi100&quot;&gt;—-N2-runlm-b, fig.path=’2014-02-10_’, dpi=100————————-&lt;/h2&gt;

&lt;p&gt;plotProfile(ctd, “N2”) lines(N2best, ctd[[‘pressure’]], col=”red”)&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Hodograph drawing</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/08/hodograph.html"/>
   <updated>2014-02-08T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/08/hodograph</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;The polar graph known as a hodograph can be useful for vector plots, and also for showing varition within nearly-cyclical time series data. The Oce R package should have a function to create hodographs, but as usual my first step is to start by writing isolated code, testing to find the right match between the function and real-world needs.&lt;/p&gt;

&lt;p&gt;The code chunk given below is such a test, with the build-in dataset named &lt;code&gt;co2&lt;/code&gt;, which is a time-series starting in 1959. The hodograph is for the variation of CO2 from its value in 1959, so the data start at zero radius. Climatologists will why this makes sense, and climate-change deniars will think it’s part of a hoax.&lt;/p&gt;

&lt;p&gt;I will leave documentation of the function for a later time, conscious of the fact that the argument list and the aesthtics of the output are likely to change with use.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;First, define &lt;code&gt;hodograph()&lt;/code&gt;, with arguments that suffice for a simple problem of a periodic signal &lt;em&gt;x=x(t)&lt;/em&gt; to be plotted in polar fashion with radius indicating &lt;em&gt;x&lt;/em&gt; and angle indicating &lt;em&gt;t&lt;/em&gt; modulo 1 year.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;hodograph &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; rings&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ringlabels &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tcut &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;daily&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;yearly&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; 
    &lt;span class=&#39;kc&#39;&gt;...&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    tcut &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; match.arg&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;tcut&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;missing&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        stop&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;x-y method not coded yet\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;missing&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
            stop&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;cannot give y if t is given\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
        &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;tcut &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;yearly&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
            &lt;span class=&#39;c1&#39;&gt;## x=x(t)&lt;/span&gt;
            t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXlt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            start &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ISOdatetime&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1900&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; as.POSIXlt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;year&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
                tz &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; attr&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;tzone&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
            day &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;julian&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; origin &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; start&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
            xx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;day&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;365&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            yy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;day&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;365&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            &lt;span class=&#39;c1&#39;&gt;## axes&lt;/span&gt;
            &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;missing&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rings&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; 
                rings &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; pretty&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sqrt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; yy&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
            rscale &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.04&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rings&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            theta &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; yy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xlim &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; rscale &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; ylim &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; rscale &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; 
                c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xlab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; axes &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            &lt;span class=&#39;c1&#39;&gt;## month lines&lt;/span&gt;
            month &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Jan&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Feb&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Mar&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Apr&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;May&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Jun&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Jul&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Aug&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
                &lt;span class=&#39;s&#39;&gt;&amp;quot;Sep&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Oct&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Nov&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Dec&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            day &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;28&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            rscale &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rings&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            &lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;m &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;12&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
                &lt;span class=&#39;c1&#39;&gt;## boundaries are for non leap years&lt;/span&gt;
                phi &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;day&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;m&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; day&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;sum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;day&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rscale &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;phi&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; rscale &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;phi&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; 
                  c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                phi &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;12&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;m &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;12&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.15&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; rscale &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;phi&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.15&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; rscale &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;phi&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; month&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;m&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
            &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
            &lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;r &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; rings&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
                &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;r &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
                  gx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; r &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;theta&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                  gy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; r &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;theta&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                  lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;gx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; gy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                  &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ringlabels&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; 
                    text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;gx&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; format&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;r&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
                &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
            &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
            points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; yy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;...&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
            stop&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;only tcut=\&amp;quot;yearly\&amp;quot; works at this time\n&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;This may be tested as follows&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;co2&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
year &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;time&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;co2&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
t0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXlt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;1959-01-01 00:00:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; t0 &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;year &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; year&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;365&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;86400&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
hodograph&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; co2 &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; co2&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; t &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tcut &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;yearly&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ringlabels &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-08-hodograph.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;The plot is informative. I’ve looked at the &lt;code&gt;co2&lt;/code&gt; data before, without really noticing the interannual variation, which is clearly seen as variation in the spacing of the spiraling data trace. For comparison, consider a conventional time-series plot.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;co2&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-02-08-timeseries.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;The function is useful as it is, but some improvements are indicated. For example, the ring labels are often over-written by the axes, and the only solution on offer presently is to skip the labels.&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-02-08-hodograph.R&quot;&gt;2014-04-08-hodograph.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>Spline wiggles (II)</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/04/splines-2.html"/>
   <updated>2014-02-04T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/04/splines-2</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;This follows up on the previous posting, using data provided by Akima (1972). The four panels of the plot produced by the following code compare the original Akima spline formula with an improved version, and three styles of &lt;code&gt;spline()&lt;/code&gt; fits.&lt;/p&gt;

&lt;p&gt;As noted in the code, two &lt;code&gt;spline()&lt;/code&gt; methods are useless for general tasks and are ignored here. The &lt;code&gt;&amp;quot;period&amp;quot;&lt;/code&gt; method sets the endpoint y-values equal, which will be useless in most applications. The &lt;code&gt;&amp;quot;hyman&amp;quot;&lt;/code&gt; method requires the y values to be increasing, which again is useless in most applications.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;The code first creates the data, the MD=1 case of Akima (1972), and defines &lt;code&gt;xx&lt;/code&gt; as a finer-resolution version of &lt;code&gt;x&lt;/code&gt; for plotting. Then it defines a function &lt;code&gt;start&lt;/code&gt; for common operations on each panel, and then it displays comparisons. The idea of showing each in reference to the original akima method is to guide the eye, since plotting all in one panel makes a tangle that is difficult to grasp.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt; png&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;splines2.png&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; width&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; height&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; unit&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;in&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; res&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;150&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pointsize&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;8&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## Data from &amp;quot;MD=1&amp;quot; set of akima1972iasc&lt;/span&gt;
x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;  &lt;span class=&#39;m&#39;&gt;6&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;  &lt;span class=&#39;m&#39;&gt;6&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;  &lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;   &lt;span class=&#39;m&#39;&gt;8&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;   &lt;span class=&#39;m&#39;&gt;9&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;80&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;150&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## A mesh for plotting&lt;/span&gt;
xx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;akima&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;                         &lt;span class=&#39;c1&#39;&gt;# for aspline()&lt;/span&gt;

start &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
    akima &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; aspline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; method&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;original&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;akima&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; akima&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lty&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;

start&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
akima &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; aspline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; method&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;improved&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;akima&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; akima&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topleft&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;aspline/original&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;aspline/improved&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; bg&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

start&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
fun &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; splinefun&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; method&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;fmm&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; fun&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topleft&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;aspline/original&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;spline/fmm&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; bg&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;


start&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
fun &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; splinefun&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; method&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;natural&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; fun&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topleft&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;aspline/original&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;spline/natural&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; bg&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;


start&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
fun &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; splinefun&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; method&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;monoH.FC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; fun&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xx&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topleft&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;aspline/original&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;spline/monoH.FC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; bg&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;


&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt; dev.off&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;/assets/splines2.png&quot;&gt;&lt;img src=&quot;/assets/splines2-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;spline()&lt;/code&gt; with &lt;code&gt;method=&amp;quot;natural&amp;quot;&lt;/code&gt; or &lt;code&gt;&amp;quot;fmm&amp;quot;&lt;/code&gt; produces undesirable wiggles (for x between 5 and 6).&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;&lt;code&gt;spline()&lt;/code&gt; with &lt;code&gt;method=&amp;quot;monoH.FC&amp;quot;&lt;/code&gt; produces results that re very similar to &lt;code&gt;aspline()&lt;/code&gt; with &lt;code&gt;method=&amp;quot;original&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Arguably, &lt;code&gt;aspline()&lt;/code&gt; with &lt;code&gt;method=&amp;quot;original&amp;quot;&lt;/code&gt; produces results most similar to what one might draw by hand; as just noted, &lt;code&gt;spline()&lt;/code&gt; with &lt;code&gt;method=&amp;quot;monoH.FC&amp;quot;&lt;/code&gt; produces essentially equivalent results.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;It would be a bad idea to base general selection on just this one test, but the code provided here is easy to modify for real data (alter lines 5 and 6), so this posting may be useful to readers.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;citations&quot;&gt;Citations&lt;/h1&gt;

&lt;p&gt;Hiroshi Akima, 1972. &lt;a href=&quot;http://dl.acm.org/citation.cfm?doid=355604.355605&quot;&gt;Algorithm 433 Interpolation and smooth curve fitting based on local procedures (E2)&lt;/a&gt;. Communications of the Association for Computing Machinery, 15(10): 914-918.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Spline wiggles (I)</title>
   <link href="http://dankelley.github.io/blog//r/2014/02/03/splines.html"/>
   <updated>2014-02-03T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/02/03/splines</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;An interesting paper (Smith and Wessel, 1990) points out a weakness in using splines in cases with data gaps. Their illustration of the problem with isobaths was particularly compelling. I cannot reproduce their Fig 1b here, owing to copyright problems, but I digitized the data so I could test two R functions for splines. Readers can follow along with the code given in this post.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;The first step is to load the data. (Ignore the extra digits, which simply result from naive copying of digitized values. I suppose the error is of order 2 percent or so, given the scanning of the diagram and my ability to position the pointer on my computer screen.)&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;distance &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;23.17400&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;25.09559&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;31.15092&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;40.75568&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
              &lt;span class=&#39;m&#39;&gt;46.42938&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;124.68628&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;132.20556&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;136.81277&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
              &lt;span class=&#39;m&#39;&gt;141.37564&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;145.08263&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;149.38977&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
topography &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-98.99976&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-97.44730&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-100.15198&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-98.66016&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                &lt;span class=&#39;m&#39;&gt;-98.66016&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-193.94266&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-296.89045&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-392.63991&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                &lt;span class=&#39;m&#39;&gt;-493.85330&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-591.21586&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-692.82951&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, plot the data.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt; png&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;splines.png&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; width&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; height&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; unit&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;in&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; res&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;150&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pointsize&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;8&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;distance&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; topography&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-700&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;16&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Now, set up a grid, and show the results of &lt;code&gt;smooth.spline()&lt;/code&gt;.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;d &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;distance&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;distance&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
s &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; smooth.spline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;topography &lt;span class=&#39;o&#39;&gt;~&lt;/span&gt; distance&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
ps &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;s&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ps&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ps&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Now, load the Akima package to get &lt;code&gt;aspline()&lt;/code&gt;, which presumably stems from Akima (1970).&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;akima&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
akima &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; aspline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;distance&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; topography&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;akima&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; akima&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Finally, draw a legend and finish up.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;bottomleft&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;lwd&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; bg&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
       col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;black&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
       legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;smooth.spline&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;aspline&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt; dev.off&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;/assets/splines.png&quot;&gt;&lt;img src=&quot;/assets/splines-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;At least on this problem, &lt;code&gt;aspline()&lt;/code&gt; does a much better job than &lt;code&gt;smooth.spline()&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;citations&quot;&gt;Citations&lt;/h1&gt;

&lt;p&gt;W. H. F. Smith and P. Wessel, 1990. Gridding with continuous curvature splines in tension. Geophysics, 55(3): 293-305.&lt;/p&gt;

&lt;p&gt;Hiroshi Akima, 1970. A new method of interpolation and smooth curve fitting based on local procedures. Journal of the Association for Computing Machinery, 17(4): 589-602.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>GMT topography colours (II)</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/30/gmt-colors-topography-2.html"/>
   <updated>2014-01-30T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/30/gmt-colors-topography-2</id>
   <content type="html">&lt;p&gt;This follows an item about GMT colours. In the meantime I have found a &lt;a href=&quot;http://www.geos.ed.ac.uk/it/howto/GMT/CPT/palettes.html&quot;&gt;website&lt;/a&gt; illustrating the colours, and also the &lt;a href=&quot;http://www.beamreach.org/maps/gmt/share/cpt&quot;&gt;definition files&lt;/a&gt; for those palettes.&lt;/p&gt;

&lt;p&gt;The palette in question is named &lt;code&gt;GMT_relief&lt;/code&gt;, and it is defined in a file that is as follows.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;&lt;span class=&#39;c&#39;&gt;#	$Id: GMT_relief.cpt,v 1.1 2001/09/23 23:11:20 pwessel Exp $&lt;/span&gt;
&lt;span class=&#39;c&#39;&gt;#&lt;/span&gt;
&lt;span class=&#39;c&#39;&gt;# Colortable for whole earth relief used in Wessel topomaps&lt;/span&gt;
&lt;span class=&#39;c&#39;&gt;# Designed by P. Wessel and F. Martinez, SOEST&lt;/span&gt;
&lt;span class=&#39;c&#39;&gt;# COLOR_MODEL = RGB&lt;/span&gt;
-8000	0	0	0	-7000	0	5	25
-7000	0	5	25	-6000	0	10	50
-6000	0	10	50	-5000	0	80	125
-5000	0	80	125	-4000	0	150	200
-4000	0	150	200	-3000	86	197	184
-3000	86	197	184	-2000	172	245	168
-2000	172	245	168	-1000	211	250	211
-1000	211	250	211	0	250	255	255
0	70	120	50	500	120	100	50
500	120	100	50	1000	146	126	60
1000	146	126	60	2000	198	178	80
2000	198	178	80	3000	250	230	100
3000	250	230	100	4000	250	234	126
4000	250	234	126	5000	252	238	152
5000	252	238	152	6000	252	243	177
6000	252	243	177	7000	253	249	216
7000	253	249	216	8000	255	255	255
F	255	255	255				
B	0	0	0
N	255	255	255
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;R code to read this file and construct 16-piece linear ramps between the levels is as follows.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;breakPerLevel &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;16&lt;/span&gt; &lt;span class=&#39;c1&#39;&gt;# say&lt;/span&gt;
d &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; read.table&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;GMT_relief.cpt&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; comment&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;#&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; nrows&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;17&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                col.names&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;lr&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;lg&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;lb&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                            &lt;span class=&#39;s&#39;&gt;&amp;quot;u&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;ur&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;ug&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;ub&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
nlevel &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; breakPerLevel&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; nlevel&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
breaks &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
col &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;l &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;nlevel&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    lowerColor &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; rgb&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;lr&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;lg&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;lb&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    upperColor &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; rgb&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;ur&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;ug&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;ub&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    breaks &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;breaks&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;u&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;l&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;breakPerLevel&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    col &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;col&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; colorRampPalette&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lowerColor&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; upperColor&lt;span class=&#39;p&#39;&gt;))(&lt;/span&gt;breakPerLevel&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## drop a colour to get length matchup for imagep()&lt;/span&gt;
col &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; col&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
nbreaks &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;breaks&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;nbreaks&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; breaks&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;col&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;topoWorld&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
imagep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;topoWorld&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; breaks&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;breaks&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;col&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;A graph of the results is below.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/gmt_relief_2.png&quot;&gt;&lt;img src=&quot;/assets/gmt_relief_2-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>GMT topography colours (I)</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/30/gmt-colors-topography.html"/>
   <updated>2014-01-30T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/30/gmt-colors-topography</id>
   <content type="html">&lt;p&gt;I enjoyed the &lt;a href=&quot;http://menugget.blogspot.ca/2014/01/importing-bathymetry-and-coastline-data.html&quot;&gt;blog posting&lt;/a&gt; by “me nugget”, which I ran across on R-bloggers, and so I decided to try that author’s GMT colourscheme. This revealed some intriguing patterns in the Oce dataset named &lt;code&gt;topoWorld&lt;/code&gt;. The following code produces a graph to illustrate.&lt;/p&gt;

&lt;h1 id=&quot;1_set_up_colours_as_suggested_on_the_menuggest_blog&quot;&gt;1. Set up colours as suggested on the “menuggest” blog&lt;/h1&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8
9&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;c1&#39;&gt;## test GMT colours as suggested by&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## http://menugget.blogspot.ca/2014/01/importing-bathymetry-and-coastline-data.html&lt;/span&gt;
ocean.pal &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; colorRampPalette&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;#000000&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#000209&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#000413&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#00061E&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;#000728&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#000932&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#002650&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#00426E&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#005E8C&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#007AAA&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#0096C8&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;#22A9C2&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#45BCBB&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#67CFB5&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#8AE2AE&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#ACF6A8&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#BCF8B9&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#CBF9CA&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;#DBFBDC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#EBFDED&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
land.pal &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; colorRampPalette&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;#336600&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#F3CA89&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#D9A627&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#A49019&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#9F7B0D&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;s&#39;&gt;&amp;quot;#996600&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#B27676&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#C2B0B0&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#E5E5E5&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;#FFFFFF&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;## Loading required package: methods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;topoWorld&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
waterBreaks &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-10000&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; by &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;50&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
landBreaks &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10000&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; by &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;50&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
imagep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;topoWorld&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; breaks &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;waterBreaks&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; landBreaks&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ocean.pal&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;waterBreaks&lt;span class=&#39;p&#39;&gt;)),&lt;/span&gt; 
    land.pal&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;landBreaks&lt;span class=&#39;p&#39;&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/2014-01-30_gmt.png&quot; alt=&quot;center&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Source code: &lt;a href=&quot;/assets/2014-01-30-gmt-colors-topography.R&quot;&gt;2014-01-30-gmt-colors-topography.R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>Vote splitting in Canada</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/25/canada-election-split.html"/>
   <updated>2014-01-25T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/25/canada-election-split</id>
   <content type="html">&lt;h1 id=&quot;analysis&quot;&gt;Analysis&lt;/h1&gt;

&lt;p&gt;District-by-district data reveal that if the Bloc Quebecois, Green, Liberal, and NDP parties were to have been united, the Conservative party would have lost the 41st Canadian election by a dramatic measure, instead of winning a majority.&lt;/p&gt;

&lt;p&gt;The graph given below shows the results by naming the ridings. Clicking on the graph will let you see results riding by riding, but the overview is also useful. The first two columns show the actual election results, with those that went Conservative (in the first-past-the-post system) to the left, and those that went to another party to the right. A clear majority is seen at a glance. The two columns on the right are analogous, but under the scenario that the non-Conservative parties were to form a new party.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/vote-split.png&quot;&gt;&lt;img src=&quot;/assets/vote-split-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Note that a few fringe parties were removed from the analysis.)&lt;/p&gt;

&lt;h1 id=&quot;r_code_that_made_the_graph&quot;&gt;R code that made the graph&lt;/h1&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;c1&#39;&gt;## DATA SOURCE: the file named e41m.txt was downloaded &lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## 2011-05-04 from http://enr.elections.ca/DownloadResults.aspx &lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## (after clicking the &amp;#39;latest results&amp;#39; link near the bottom of&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## the left-hand column).  Some trailing blank lines were removed.&lt;/span&gt;
e &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; read.csv&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;e41m.txt&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sep&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;\t&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; encoding&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latin1&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## shorten column names&lt;/span&gt;
colNames &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;distNum&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;distName&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;distNameFR&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;typeFR&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;lname&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;mname&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;fname&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
              &lt;span class=&#39;s&#39;&gt;&amp;quot;affil&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;affilFR&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;votes&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;percentVotes&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;rejected&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;total&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
names&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; colNames
&lt;span class=&#39;c1&#39;&gt;## remove columns that we won&amp;#39;t use&lt;/span&gt;
e &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; e&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; names&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;!=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;distNameFR&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
e &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; e&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; names&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;!=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;typeFR&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
e &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; e&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; names&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;!=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;affilFR&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
e &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; e&lt;span class=&#39;p&#39;&gt;[,&lt;/span&gt; names&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;!=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;mname&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## shorten relevant party names&lt;/span&gt;
levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Bloc Québécois&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Bloc&amp;quot;&lt;/span&gt;
levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Conservative&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Con&amp;quot;&lt;/span&gt;
levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Green Party&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Green&amp;quot;&lt;/span&gt;
levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Liberal&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Lib&amp;quot;&lt;/span&gt;
levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;levels&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;NDP-New Democratic Party&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;NDP&amp;quot;&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## categorize by district&lt;/span&gt;
f &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; factor&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;distNum&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
ee &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; split&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;e&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; f&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
district &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
bloc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
green &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
con &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
lib &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
ndp &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
conWon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
conWouldWin &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;NULL&lt;/span&gt;
nd &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ee&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;i &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;nd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    d &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ee&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;][[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]&lt;/span&gt;
    &lt;span class=&#39;c1&#39;&gt;## restrict to validated data, if we have them&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;any&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;type &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;validated&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
        d &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; d&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;type &lt;span class=&#39;o&#39;&gt;==&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;validated&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,]&lt;/span&gt;
    affil &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.character&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;affil&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    percentVotes &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;percentVotes
    district &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;district&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; as.character&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;distName&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]))&lt;/span&gt;
    thisbloc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;any&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Bloc&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; percentVotes&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Bloc&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
    thiscon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;any&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Con&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; percentVotes&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Con&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
    thisgreen &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;any&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Green&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; percentVotes&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Green&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
    thislib &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;any&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Lib&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; percentVotes&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Lib&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
    thisndp &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;any&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;NDP&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; percentVotes&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;affil&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;NDP&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
    con &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;con&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thiscon&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    ndp &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ndp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thisndp&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    lib &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lib&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thislib&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    bloc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;bloc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thisbloc&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    green &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;green&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thisgreen&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    conWon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;conWon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thiscon &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;thisndp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thislib&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thisbloc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thisgreen&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    conWouldWin &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;conWouldWin&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thiscon &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; sum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;thisndp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thislib&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thisbloc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; thisgreen&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
results &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; data.frame&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;district&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; con&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ndp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lib&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; bloc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; green&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; conWon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; conWouldWin&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
results &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; results&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;order&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;results&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;district&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;

png&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;split.png&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; width&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;8.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; height&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;11&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; unit&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;in&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; res&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pointsize&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; xlab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
jconwon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
jconwonnot &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
jconwouldwin &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
jconwouldwinnot &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
yy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.0051&lt;/span&gt;
cex &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.45&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.01&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Actual results&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.01&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;If &amp;#39;left&amp;#39; not split&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.005&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Conservatives won&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.005&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Conservatives lost&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.6&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.005&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Conservatives would win&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.8&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.005&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Conservatives would lose&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;i &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;nd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    district &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; iconv&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;as.character&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;results&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;district&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;]),&lt;/span&gt; to&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTF8&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;results&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;conWon&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;yy&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;jconwon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; district&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;cex&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        jconwon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; jconwon &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;results&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;conWon&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;yy&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;jconwonnot&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; district&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;cex&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        jconwonnot &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; jconwonnot &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;results&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;conWouldWin&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.6&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;yy&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;jconwouldwin&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; district&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;cex&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        jconwouldwin &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; jconwouldwin &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;results&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;conWouldWin&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;i&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.8&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;yy&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;jconwouldwinnot&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; district&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;cex&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        jconwouldwinnot &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; jconwouldwinnot &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
dev.off&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</content>
 </entry>
 
 <entry>
   <title>How entries are added</title>
   <link href="http://dankelley.github.io/blog//development/2014/01/24/how-this-blog-is-used.html"/>
   <updated>2014-01-24T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/development/2014/01/24/how-this-blog-is-used</id>
   <content type="html">&lt;p&gt;Entries are added to this blog simpy by creating files in the &lt;code&gt;_posts/&lt;/code&gt; directory. There is an important convention on the file names: they must start with the year, followed by a dash, followed by the decimal number (with leading zero if appropriate), followed by the day, followed by a dash and then followed by some title words, and with &lt;code&gt;.md&lt;/code&gt; at the end.&lt;/p&gt;

&lt;p&gt;The format of the blog entries is markdown for the main body, but the first part must be a preface in so-called YAML format. See any existing blog entry for the format, which should be simple to understand.&lt;/p&gt;

&lt;p&gt;Since Markdown errors will cause non-display of the item when it is eventually uploaded to github, it is important to test things locally first. This is very easy. In the commandline, type&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;jekyll serve --watch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;to start a server. It will state a local URL that holds the blog. Cut and past that URL in a browser, and you will see a local copy of the blog. Every time you edit a file, &lt;code&gt;jekyll&lt;/code&gt; will update the blog, but you will need to do a browser refresh to see the results.&lt;/p&gt;

&lt;p&gt;Once things work well locally, type the following in a terminal to upload the blog to github.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;make
git add .
git commit -m MSG
git push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;PS. the &lt;code&gt;make&lt;/code&gt; part of the above is important, because it moves a tags file from a location where github will not find it, to another where it will be found. Simply using &lt;code&gt;git&lt;/code&gt; to upload files will give a blog that works in all respects except for tagging, but what would be the point of that?&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>How this blog was made</title>
   <link href="http://dankelley.github.io/blog//development/2014/01/23/how-this-blog-was-made.html"/>
   <updated>2014-01-23T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/development/2014/01/23/how-this-blog-was-made</id>
   <content type="html">&lt;h2 id=&quot;motivation&quot;&gt;Motivation&lt;/h2&gt;

&lt;p&gt;After using WordPress (WP, henceforth) for a month or so, I got tired of the divergence that always seemed to happen between my local (R-markdown) source and the normal-markdown on wordpress. My pattern was to write something rough locally in Rmd and then use knitr to create local markdown, and then upload it. That would be fine but WP has some special tricks for figure inclusion, so the markdown file on WP will not be the same as locally. And then I always edit everything when I see it on the screen, so that also makes the WP markdown file differ from the local one. And, finally, WP changes some of the markdown from characters I like (less-than, for example) into silly html characters. The consequence of all this is that my local source copy is not the same as the source on WP, and I do not like that since it means I have no archive in case WP decides to charge me, or goes out of business, or puts larger ads on their site. I wanted to try other blogging methods, and github/jekyll came to mind because I use github a lot.&lt;/p&gt;

&lt;h2 id=&quot;methods&quot;&gt;Methods&lt;/h2&gt;

&lt;p&gt;I read through the jekyll docs to get a general idea, and made a blog. Of course it did not work, so I started searching for hints. I do not even recall the original problem, but in any case I solved it, and along the way I ran across &lt;a href=&quot;http://ocramius.github.io&quot;&gt;http://ocramius.github.io&lt;/a&gt;, a site that had what I wanted (especially tags, which the jekyll docs do not discuss), so I started using that as a resource. Then I noticed that it was in turn based on &lt;a href=&quot;http://erjjones.github.io/blog/Part-two-how-I-built-my-blog/&quot;&gt;http://erjjones.github.io/blog/Part-two-how-I-built-my-blog/&lt;/a&gt;, so that became my go-to source for practical hints.&lt;/p&gt;

&lt;h2 id=&quot;some_snags_and_how_to_deal_with_them&quot;&gt;Some snags and how to deal with them:&lt;/h2&gt;

&lt;p&gt;Any errors on the github server can yield blank pages, and the time delay of a minute or so makes it important to get things right locally before uploading. The solution is simple: run a local jekyll server with the unix command&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;jekyll serve --watch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If there are errors, try stopping the server and running&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;jekyll build --trace
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once things work well locally, do&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;make
git add .
git commit -m MSG
git push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;to upload to github.&lt;/p&gt;

&lt;p&gt;The method of generating tags (which I got from ocramius, who got it from erjjones) puts the tag-list files into &lt;code&gt;_site/tags&lt;/code&gt; but jekyll will not serve the files from there. They must go into &lt;code&gt;tags&lt;/code&gt; at the top level. The solution I am using is to continue using the ruby script that I found for creating tags, but to use a Makefile to shift the file locations.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>1D optimization in R</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/22/1D-optimization-in-R.html"/>
   <updated>2014-01-22T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/22/1D-optimization-in-R</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;R provides functions for both one-dimensional and multi-dimensional optimization. The second topic is much more complicated than the former (see e.g. Nocedal 1999) and will be left for another day.&lt;/p&gt;

&lt;p&gt;A convenient function for 1D optimization is &lt;code&gt;optimize()&lt;/code&gt;, also known as &lt;code&gt;optimise()&lt;/code&gt;. Its first argument is a function whose minimum (or maximum) is sought, and the second is a two-element vector giving the range of values of the independent variable to be searched. (See &lt;code&gt;?optimize&lt;/code&gt; for more.)&lt;/p&gt;

&lt;h1 id=&quot;application&quot;&gt;Application&lt;/h1&gt;

&lt;p&gt;As an example, consider the phase speed of deep gravity-capillary waves, which is given by $\omega/k$ where $\omega$ is the frequency and $k$ is the wavenumber, and the two are bound together with the dispersion relationship $\omega^2=gk+\sigma k^3/\rho$, where $g$ is the acceleration due to gravity, $\sigma$ is the surface tension parameter (0.074 N/m for an air-water interface) and $\rho$ is the water density (1000 kg/m^3 for fresh water). This yields wave speed given by the following R function.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;phaseSpeed &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;k&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    g &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;9.8&lt;/span&gt;
    sigma &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.074&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# water-air&lt;/span&gt;
    rho &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1000&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# fresh water&lt;/span&gt;
    omega2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; g &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; k &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; sigma &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; k&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;rho
    sqrt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;omega2&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;k
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;It makes sense to plot a function to be optimized, if only to check that it has been coded correctly, so that is the next step. Readers who are familiar with gravity-capillary waves may know that the speed is minimum at wavelengths of about 2 cm, or wavenumbers of approximately $2\pi/0.02=300$; this suggests an x range for the plot.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;k &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1000&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;k&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; phaseSpeed&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;k&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xlab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Wavenumber&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Phase speed&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/optimize.png&quot; alt=&quot;graph&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The results suggest that the range of $k$ illustrate contains the minimum, so we provide that to &lt;code&gt;optimize()&lt;/code&gt;.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;o &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; optimize&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;phaseSpeed&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;k&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
phaseSpeed&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;o&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;minimum&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## [1] 0.2321&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;This speed is not especially fast; it would take about a heartbeat to move past your hand.&lt;/p&gt;

&lt;h1 id=&quot;exercises&quot;&gt;Exercises&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Use &lt;code&gt;str(o)&lt;/code&gt; to learn about the contents of the optimized solution.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Use &lt;code&gt;abline()&lt;/code&gt; to indicate the wavenumber at the speed minimum.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Try other functions that are of interest to you, e.g. find the angle that maximizes $\sin\theta\cos\theta$, which yields the throwing angle that achieves furthest distance in frictionless air over flat terrain.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Use the multi-dimensional optimizer named &lt;code&gt;optim()&lt;/code&gt; on this problem.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;p&gt;Jorge Nocedal and Stephen J. Wright, 1999. &lt;em&gt;Numerical optimization.&lt;/em&gt; Springer series in operations research. Springer-Verlag, New York, NY, USA.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Using the plyr package</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/18/using-the-plyr-package.html"/>
   <updated>2014-01-18T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/18/using-the-plyr-package</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;The base R system provides &lt;code&gt;lapply()&lt;/code&gt; and related functions, and the package &lt;code&gt;plyr&lt;/code&gt; provides alternatives that are worth considering. It will be assumed that readers are familiar with &lt;code&gt;lapply()&lt;/code&gt; and are willing to spend a few moments reading the &lt;code&gt;plyr&lt;/code&gt; documentation, to see why the illustration here will use the &lt;code&gt;ldply()&lt;/code&gt; function.&lt;/p&gt;

&lt;p&gt;The test task will be extraction of latitude (and then both latitude and longitude) from the &lt;code&gt;section&lt;/code&gt; dataset in the &lt;code&gt;oce&lt;/code&gt; package. (Users of that package may be aware that there is a built-in accessor for doing this, so results can easily be checked.)&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;First, load the data&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;section&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, find latitudes using &lt;code&gt;lapply&lt;/code&gt;&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;lat &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; unlist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lapply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;section&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;station&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, find latitudes with &lt;code&gt;ldply&lt;/code&gt;&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;plyr&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lat &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ldply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;section&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;station&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;The reader can check that the results match, although &lt;code&gt;ldply()&lt;/code&gt; returns a data frame, not a vector as in the first method. Tests of speed&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;microbenchmark&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
microbenchmark&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ldply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;section&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;station&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]])&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;V1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    unlist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lapply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;section&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;station&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]])))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;yield the following&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;c1&#39;&gt;## Unit: milliseconds&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;##                                                               expr   min&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;##        ldply(section[[&amp;quot;station&amp;quot;]], function(x) x[[&amp;quot;latitude&amp;quot;]])$V1 18.99&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;##  unlist(lapply(section[[&amp;quot;station&amp;quot;]], function(x) x[[&amp;quot;latitude&amp;quot;]])) 18.36&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;##     lq median    uq   max neval&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;##  20.26  20.56 21.02 36.05   100&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;##  19.71  19.93 20.64 63.18   100&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;suggesting a difference too small to be of much practical interest.&lt;/p&gt;

&lt;h1 id=&quot;discussion&quot;&gt;Discussion&lt;/h1&gt;

&lt;p&gt;Since &lt;code&gt;ldply()&lt;/code&gt; returns a data frame, it is more flexible than &lt;code&gt;unlist()&lt;/code&gt;, which returns a vector. For example, the following creates a data frame with columns for lat and lon:&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;latlon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ldply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;section&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;station&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;latitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;longitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;A station plot is produced as follows.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;mapPlot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorld&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; projection &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;orthographic&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; orientation &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-40&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
mapPoints&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;latlon&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;V2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; latlon&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;V1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;+&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/plyr.png&quot; alt=&quot;figure&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;The effort of learning how to use the &lt;code&gt;plyr&lt;/code&gt; package is likely to pay off in more flexible code, particularly because of the use of data frames in that package. On this theme, note that the author of &lt;code&gt;plyr&lt;/code&gt; is developing a similar package called &lt;code&gt;dplry&lt;/code&gt;, which centres more closely on data frames and offers many new features; see &lt;a href=&quot;http://blog.rstudio.org/2014/01/17/introducing-dplyr/&quot;&gt;http://blog.rstudio.org/2014/01/17/introducing-dplyr/&lt;/a&gt; for a blog item introducing &lt;code&gt;dplyr&lt;/code&gt;.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Colourizing a trajectory</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/15/colourizing-along-a-trajectory.html"/>
   <updated>2014-01-15T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/15/colourizing-along-a-trajectory</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;In Oceanography it can be useful to use colour to display z values along an (x,y) trajectory. For example, CTD data might be displayed in this way, with x being distance along track, y being depth, and z being temperature. This post shows how one might do this.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;The R code given below demonstrates this with fake data. The core idea is to use &lt;code&gt;segments()&lt;/code&gt;, here with &lt;code&gt;head()&lt;/code&gt; and &lt;code&gt;tail()&lt;/code&gt; to chop up the trajectory.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;50&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; x&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;
z &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
zlim &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
npalette &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;

palette &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; oceColorsJet&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;npalette&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
drawPalette&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;zlim &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; zlim&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; palette&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;head&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; head&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
  tail&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; tail&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
  col &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; palette&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;findInterval&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;z&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
    seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;zlim&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; zlim&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; length.out &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; npalette&lt;span class=&#39;p&#39;&gt;))],&lt;/span&gt;
  lwd &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;The graph shows that this works reasonably well. The dots will probably not be useful in an actual application, and are used here just to indicate colourization in groups.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/colorline.png&quot;&gt;&lt;img src=&quot;/assets/colorline-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The method works well, and is flexible in terms of colour schemes.&lt;/p&gt;

&lt;h1 id=&quot;exercises&quot;&gt;Exercises&lt;/h1&gt;

&lt;p&gt;Find a way to blend colour between the points, perhaps by defining a euclidian distance in (x,y) space (which will of course require scaling if x and y have different units or ranges) and then using &lt;code&gt;approx()&lt;/code&gt;.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Cabelling calculations</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/15/cabelling.html"/>
   <updated>2014-01-15T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/15/cabelling</id>
   <content type="html">&lt;p&gt;&lt;em&gt;Abstract&lt;/em&gt; R code is provided in aide of laboratory demonstration of cabelling.&lt;/p&gt;

&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Setting up a cabelling experiment requires creating two watermasses of equal density, and if only S and T can be measured, that means calculating densities. Using a TS diagram and graphical interpolation is one approach to that task, but another is to use R to do the calculation.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;The code given below will do the calculation for specified &lt;code&gt;Sa&lt;/code&gt;, &lt;code&gt;Ta&lt;/code&gt; and &lt;code&gt;Sb&lt;/code&gt;, where the second letter indicates the watermass. The code uses &lt;code&gt;uniroot()&lt;/code&gt; to find the temperature &lt;code&gt;Tb&lt;/code&gt; that yields equal densities for watermasses &lt;em&gt;a&lt;/em&gt; and &lt;em&gt;b&lt;/em&gt;.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;c1&#39;&gt;# Alter next three lines as desired; a and b are watermasses.&lt;/span&gt;
Sa &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;30&lt;/span&gt;
Ta &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;
Sb &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;40&lt;/span&gt;
library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;# Should not need to edit below this line&lt;/span&gt;
rho0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swRho&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sa&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Ta&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
Tb &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; uniroot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k-Variable&#39;&gt;T&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; rho0&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;swRho&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;k-Variable&#39;&gt;T&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; lower&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; upper&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;root
Sc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sa &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Sb&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;
Tc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Ta &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Tb&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## density change, and equiv temp change&lt;/span&gt;
drho &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; swRho&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; rho0
dT &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; drho &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; rho0 &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; swAlpha&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt; png&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;cabelling.png&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; width&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; height&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                        unit&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;in&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; res&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pointsize&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;12&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plotTS&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;as.ctd&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sa&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Sb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Sc&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Ta&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tc&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
drawIsopycnals&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;levels&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;rho0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sa&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Ta&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Sb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;b&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sa&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Ta&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;a&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;Sc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tc&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;c&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topleft&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
       legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;sprintf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Sa=%.1f, Ta=%.1f, Sb=%.1f  -&amp;gt;  Tb=%.1f, drho=%.2f, dT=%.2f&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                      Sa&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Ta&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Sb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Tb&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; drho&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; dT&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
       bg&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt; dev.off&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;If run non-interactively, the code will produce a PNG file like that given below.&lt;/p&gt;

&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;The legend summarizes the results, indicating also the density change and the temperature change that would be equivalent to that density change (at the midpoint, &lt;em&gt;c&lt;/em&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cabelling.png&quot; alt=&quot;cabelling TS diagram&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;If the design goal is that the density mismatch between watermasses &lt;em&gt;a&lt;/em&gt; and &lt;em&gt;b&lt;/em&gt; should be, say, 10 percent of the density difference of the mixture watermass (&lt;em&gt;c&lt;/em&gt;), then in the illustrated case the temperature would have to be controlled to within a quarter of a degree Celcius – a task that is challenging enough to argue against this as an informal classroom demonstration.&lt;/p&gt;

&lt;h1 id=&quot;exercises&quot;&gt;Exercises&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;Alter the R code to calculate &lt;code&gt;Sb&lt;/code&gt; in terms of &lt;code&gt;Tb&lt;/code&gt;.&lt;/li&gt;

&lt;li&gt;Consider (calculate or measure) the convection associated with sidewall heat conduction.&lt;/li&gt;
&lt;/ol&gt;</content>
 </entry>
 
 <entry>
   <title>Butterworth filter overshoot</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/15/butterworth-filters.html"/>
   <updated>2014-01-15T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/15/butterworth-filters</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Butterworth filters with order other than 1 have an overshoot phenomenon that can be problematic in some cases. For example, if smoothing is used on an estimate of kinetic energy, overshoots might yield negative values that are nonphysical. This post simply illustrates this with made-up data that the reader can experiment with.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;First, create and plot some fake data, a top-hat function. (Note the use of &lt;code&gt;par&lt;/code&gt; to tighten the margins.)&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;signal&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;100&lt;/span&gt;
x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;n
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;n &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;&amp;amp;&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-0.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, decide on the cutoff frequency for a low-pass filter. Setting &lt;code&gt;W&lt;/code&gt; to 0.1 means a cutoff at 1/10-th of the Nyquist frequency.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;W &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Finally, filter with orders 1, 2 and 3, and add coloured lines indicating the results&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;b1 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; butter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; W&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
y1 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

b2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; butter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; W&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
y2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

b3 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; butter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; W&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
y3 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;b3&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y3&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;forestgreen&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topright&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
        col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;black&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;forestgreen&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
        legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Signal&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Order 1&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Order 2&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Order 3&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/butter.png&quot; alt=&quot;graph&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;Be careful in using butterworth filters of order 2 and higher, at least in applications that are sensitive to overshoot (e.g. kinetic-energy timeseries).&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Smoothing CTD profiles</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/11/smoothing-hydrographic-profiles.html"/>
   <updated>2014-01-11T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/11/smoothing-hydrographic-profiles</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Smoothing hydrographic profiles with conventional time-series methods is problematic for two reasons: (a) the data are commonly not equi-spaced in depth and (b) the data seldom lack trends in depth. The issues and their solutions are illustrated without much discussion here.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/smooth-profile.png&quot;&gt;&lt;img src=&quot;/assets/smooth-profile-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The first step in making the graph shown above is to load the &lt;code&gt;oce&lt;/code&gt; library and create a function that measures daylength by finding sunrise and sunset times. Note that &lt;code&gt;uniroot()&lt;/code&gt;, which is used to find times of zero solar altitude, needs lower and upper limits on &lt;code&gt;t&lt;/code&gt;, and these are calculated by looking back and then forward a half-day. This works well for application to Halifax, but in other timezones other offsets would be needed. Interested readers might want to devised a method based on the longitude, which can be transformed into a timezone.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;The first step is to load the data and extract dependent and independent variables, here &lt;em&gt;S&lt;/em&gt; and &lt;em&gt;p&lt;/em&gt;.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;signal&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
S &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ctd&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;salinity&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]&lt;/span&gt;
p &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ctd&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;pressure&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, one must create equispaced data, for filtering to make any sense at all.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;dp &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; median&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;diff&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
pp &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; dp&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
S0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; approx&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; S&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pp&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Now comes something that must be established by the actual task at hand: setting the critical frequency for the filter (as a ratio to Nyquist). In this case, a somewhat arbitrary frequency is selected, and then both first-order and second-order filters are created.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;W &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; dp &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;
f1 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; butter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; W&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
f2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; butter&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; W&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Now, set up for a three-panel plot.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;For the left-hand panel, show the raw data in black, and the two filters in red and blue.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;plotProfile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xtype&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;salinity&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
S0f1 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;f1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; S0&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
S0f2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;f2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; S0&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;S0f1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;S0f2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;(a) &amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; line&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-5&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;For the middle panel, detrended the profile, and then filter.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;plotProfile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xtype&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;salinity&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
Sd &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; detrend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;pp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; S0&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
S1f1 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;f1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Sd&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;Y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Sd&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;a &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Sd&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;b &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pp
S1f2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; filtfilt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;f2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; Sd&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;Y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Sd&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;a &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; Sd&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;b &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pp
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;S1f1&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;S1f2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;(b) &amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; line&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-5&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;For the right-hand panel, use a smoothing spline instead of a filter.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;spline &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; smooth.spline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;pp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; S0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; df&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;W&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
S2 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;spline&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y
plotProfile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xtype&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;salinity&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;l&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;S2&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pp&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;(c) &amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; line&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-5&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;Filtering a non-detrended profile is a generally a bad idea. There is almost always a zero-offset problem, and also most properties vary dramatically with depth, so detrending is required as well as zero offsetting. The advantage of detrending is illustrated in the left-hand and middle panels.&lt;/p&gt;

&lt;p&gt;Smoothing splines provide an attractive alternative to filtering, especially in the not-uncommon cases in which derivative are required. However, a disadvantage of splines is that there is no simple way to describe the method to those who are not familiar with them. In some branches of the literature, splines will be understood by readers, and in others, they will be a mystery that will waste a review cycle for the education of referees. There is also a problem in describing the spline simply in terms that have physical meaning. For example, spline smoothness is here controlled by setting the &lt;code&gt;df&lt;/code&gt; argument, but this has no simple analogy to physics, as perhaps the half-power frequency of a filter might (in terms of spectral models of finestructure, say).&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Inferring halocline depth</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/11/inferring-halocline-depth.html"/>
   <updated>2014-01-11T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/11/inferring-halocline-depth</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;There are no agreed-upon methods for inferring halocline depth, but a reasonable method might involve locating the depth at which &lt;em&gt;dS/dp&lt;/em&gt; is largest, where &lt;em&gt;S&lt;/em&gt; is salinity and &lt;em&gt;p&lt;/em&gt; is pressure (Kelley 2014 chapter 5). Calculating the derivative using e.g. &lt;code&gt;diff(S)/diff(p)&lt;/code&gt; can be problematic because of sensitivity to noise, especially for data that have not been bin-averaged. Achieving smoothness with conventional filtering has problems at the end-points, which is particularly troublesome for a near-surface halocline (see the next blog entry). A possible solution to such problems is to calculate the derivative with a smoothing spline.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;Pasted below is test code that does this with the ctd dataset in the oce package. The function returns the pressure at which the smoothing spline has highest salinity derivative, and it can also plot the results (which is recommended). The parameter named deltap is used to set the value of &lt;code&gt;df&lt;/code&gt; (degrees of freedom) for the spline. One might think of deltap as the thickness (in dbar) of the smoothing interval for each of the sub-components of the spline.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;findHalocline &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deltap&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; plot&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    S &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ctd&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;salinity&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]&lt;/span&gt;
    p &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; ctd&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;pressure&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]]&lt;/span&gt;
    n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;c1&#39;&gt;## trim df to be no larger than n/2 and no smaller than 3.&lt;/span&gt;
    N &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; deltap &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; median&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;diff&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    df &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; min&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;n&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; N&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
    spline &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; smooth.spline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;S&lt;span class=&#39;o&#39;&gt;~&lt;/span&gt;p&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; df&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;df&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    SS &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;spline&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; p&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    dSSdp &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; predict&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;spline&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; p&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deriv&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    H &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; p&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;which.max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;dSSdp&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;)]&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;plot&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
        plotProfile&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xtype&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;salinity&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;SS&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; SS&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        abline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;h&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;H&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sprintf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;%.2f m&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; H&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; at&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;H&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sprintf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot; deltap: %.0f, N: %.0f, df: %.0f&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; deltap&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; N&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; df&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
              side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; line&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; adj&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;return&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;H&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
  
&lt;span class=&#39;c1&#39;&gt;# Plot two panels to see influence of deltap.&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
data&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
findHalocline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
findHalocline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;ctd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;The graph shows results for a test dataset provided with the oce package, using two values for &lt;code&gt;deltap&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/halocline-depth.png&quot; alt=&quot;graph of halocline depth&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;discussion&quot;&gt;Discussion&lt;/h1&gt;

&lt;p&gt;Lacking further information about the data or a statistical model of the variation, the choice of deltap is somewhat open, and one interpretation of the results would be to state that the halocline depth is likely to be between 4 and 5 m.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>PISA scores</title>
   <link href="http://dankelley.github.io/blog//r/2014/01/06/pisa-scores.html"/>
   <updated>2014-01-06T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2014/01/06/pisa-scores</id>
   <content type="html">&lt;p&gt;The &lt;a href=&quot;http://www.theguardian.com/news/datablog/2013/dec/03/pisa-results-country-best-reading-maths-science&quot;&gt;Guardian Newspaper&lt;/a&gt; has an interesting article about the &lt;a href=&quot;http://www.oecd.org/pisa/&quot;&gt;Pisa&lt;/a&gt; (Program for International Student Assessment) scores for 2012, and it includes &lt;a href=&quot;https://docs.google.com/spreadsheet/ccc?key=0AoBYy67QwoevdHIyc2Rha2VYamZ0LUl0Xy1TdUszRkE&amp;usp=sharing#gid=0&quot;&gt;data&lt;/a&gt;. Since I was interested to see how my own region scored, I downloaded the data into a file called PISA-summary-2012.csv and created a plot summarizing scores in all the sampled regions, with Canada highlighted.&lt;/p&gt;

&lt;h1 id=&quot;graphical_summary&quot;&gt;Graphical summary&lt;/h1&gt;

&lt;p&gt;(Click the graph to see the full-size version.)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/pisa-scores.png&quot;&gt;&lt;img src=&quot;/assets/pisa-scores-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;code_that_makes_the_graph&quot;&gt;Code that makes the graph&lt;/h1&gt;

&lt;p&gt;First, read the data and set up axes.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;regionHighlight &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Canada&amp;quot;&lt;/span&gt;
d &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; read.csv&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;PISA-summary-2012.csv&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; skip&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;16&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; header&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
              col.names&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;rank&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;region&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                          &lt;span class=&#39;s&#39;&gt;&amp;quot;math&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;mathLow&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;mathHigh&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;mathChange&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                          &lt;span class=&#39;s&#39;&gt;&amp;quot;reading&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;readingChange&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                          &lt;span class=&#39;s&#39;&gt;&amp;#39;science&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;scienceChange&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
n &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;math&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
range &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;math&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;reading&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;science&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;6&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xlab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; axes&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;PISA Score (2012)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
axis&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
box&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, set parameters for label placement.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;dy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; diff&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;usr&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;50&lt;/span&gt;
x0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;
dx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;
cex &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.65&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Show Mathematics scores. The gist is in the line containing the call to &lt;code&gt;approx()&lt;/code&gt;, followed by the one calling &lt;code&gt;segments()&lt;/code&gt;; this scheme draws lines between a numerical scale and evenly-spaced labels. Thus, the eye is guided not just to the order of the ranking, but also the differences between ranked elements. For example, there is a remarkable gap in each measure, between the top performer and the second-top one.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;o &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; order&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;math&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; decreasing&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; approx&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;range&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt;range&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt;length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;n&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y
segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;math&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
     col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;regionHighlight&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;math&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;cex&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;regionHighlight&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;black&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Maths&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Show Reading scores&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;x0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x0 &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; dx 
o &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; order&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;reading&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; decreasing&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;reading&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
     col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;regionHighlight&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;reading&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;cex&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;regionHighlight&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;black&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Reading&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Finally, show Science scores.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7
8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;x0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x0 &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; dx 
o &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; order&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;science&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; decreasing&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;science&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
     col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;regionHighlight&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;science&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; n&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;cex&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;ifelse&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;region&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;o&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;regionHighlight&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;red&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;black&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x0&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dx&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; range&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;dy&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Science&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pos&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;csv_data_used_in_this_analysis&quot;&gt;CSV data used in this analysis&lt;/h1&gt;

&lt;p&gt;The data can be downloaded from a link given above, but it requires google login.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;,,&lt;span class=&#39;s2&#39;&gt;&amp;quot;Mean score&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in PISA 2012, MATHS&amp;quot;&lt;/span&gt;,&lt;span class=&#39;s2&#39;&gt;&amp;quot;Share&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;of low achievers&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in mathematics&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;(Below Level 2)&amp;quot;&lt;/span&gt;,&lt;span class=&#39;s2&#39;&gt;&amp;quot;Share&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;of top performers&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in mathematics&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;(Level 5 or 6)&amp;quot;&lt;/span&gt;,&lt;span class=&#39;s2&#39;&gt;&amp;quot;Annualised&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;change&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in score points&amp;quot;&lt;/span&gt;,&lt;span class=&#39;s2&#39;&gt;&amp;quot; Mean score&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in PISA 2012, READING&amp;quot;&lt;/span&gt;,&lt;span class=&#39;s2&#39;&gt;&amp;quot;Annualised&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;change&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in score points&amp;quot;&lt;/span&gt;,&lt;span class=&#39;s2&#39;&gt;&amp;quot;Mean score&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in PISA 2012, SCIENCE&amp;quot;&lt;/span&gt;,&lt;span class=&#39;s2&#39;&gt;&amp;quot;Annualised&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;change&lt;/span&gt;
&lt;span class=&#39;s2&#39;&gt;in score points&amp;quot;&lt;/span&gt;
1,Shanghai-China,613,3.8,55.4,4.2,570,4.6,580,1.8
3,Hong Kong-China,561,8.5,33.7,1.3,545,2.3,555,2.1
2,Singapore,573,8.3,40,3.8,542,5.4,551,3.3
7,Japan,536,11.1,23.7,0.4,538,1.5,547,2.6
12,Finland,519,12.3,15.3,-2.8,524,-1.7,545,-3
11,Estonia,521,10.5,14.6,0.9,516,2.4,541,1.5
5,Korea,554,9.1,30.9,1.1,536,0.9,538,2.6
17,Vietnam,511,14.2,13.3,m,508,m,528,m
14,Poland,518,14.4,16.7,2.6,518,2.8,526,4.6
13,Canada,518,13.8,16.4,-1.4,523,-0.9,525,-1.5
8,Liechtenstein,535,14.1,24.8,0.3,516,1.3,525,0.4
16,Germany,514,17.7,17.5,1.4,508,1.8,524,1.4
4,Taiwan,560,12.8,37.2,1.7,523,4.5,523,-1.5
20,Ireland,501,16.9,10.7,-0.6,523,-0.9,522,2.3
10,Netherlands,523,14.8,19.3,-1.6,511,-0.1,522,-0.5
19,Australia,504,19.7,14.8,-2.2,512,-1.4,521,-0.9
6,Macao-China,538,10.8,24.3,1,509,0.8,521,1.6
23,New Zealand,500,22.6,15,-2.5,512,-1.1,516,-2.5
9,Switzerland,531,12.4,21.4,0.6,509,1,515,0.6
26,United Kingdom,494,21.8,11.8,-0.3,499,0.7,514,-0.1
21,Slovenia,501,20.1,13.7,-0.6,481,-2.2,514,-0.8
24,Czech Republic,499,21,12.9,-2.5,493,,508,-1
18,Austria,506,18.7,14.3,0,490,-0.2,506,-0.8
15,Belgium,515,18.9,19.4,-1.6,509,0.1,505,-0.8
28,Latvia,491,19.9,8,0.5,489,1.9,502,2
-,OECD average,494,23.1,12.6,-0.3,496,0.3,501,0.5
25,France,495,22.4,12.9,-1.5,505,0,499,0.6
22,Denmark,500,16.8,10,-1.8,496,0.1,498,0.4
36,United States,481,25.8,8.8,0.3,498,-0.3,497,1.4
33,Spain,484,23.6,8,0.1,488,-0.3,496,1.3
37,Lithuania,479,26,8.1,-1.4,477,1.1,496,1.3
30,Norway,489,22.3,9.4,-0.3,504,0.1,495,1.3
32,Italy,485,24.7,9.9,2.7,490,0.5,494,3
39,Hungary,477,28.1,9.3,-1.3,488,1,494,-1.6
29,Luxembourg,490,24.3,11.2,-0.3,488,0.7,491,0.9
40,Croatia,471,29.9,7,0.6,485,1.2,491,-0.3
31,Portugal,487,24.9,10.6,2.8,488,1.6,489,2.5
34,Russian Federation,482,24,7.8,1.1,475,1.1,486,1
38,Sweden,478,27.1,8,-3.3,483,-2.8,485,-3.1
27,Iceland,493,21.5,11.2,-2.2,483,-1.3,478,-2
35,Slovak Republic,482,27.5,11,-1.4,463,-0.1,471,-2.7
41,Israel,466,33.5,9.4,4.2,486,3.7,470,2.8
42,Greece,453,35.7,3.9,1.1,477,0.5,467,-1.1
44,Turkey,448,42,5.9,3.2,475,4.1,463,6.4
48,United Arab Emirates,434,46.3,3.5,m,442,m,448,m
47,Bulgaria,439,43.8,4.1,4.2,436,0.4,446,2
43,Serbia,449,38.9,4.6,2.2,446,7.6,445,1.5
51,Chile,423,51.5,1.6,1.9,441,3.1,445,1.1
50,Thailand,427,49.7,2.6,1,441,1.1,444,3.9
45,Romania,445,40.8,3.2,4.9,438,1.1,439,3.4
46,Cyprus,440,42,3.7,m,449,m,438,m
56,Costa Rica,407,59.9,0.6,-1.2,441,-1,429,-0.6
49,Kazakhstan,432,45.2,0.9,9,393,0.8,425,8.1
52,Malaysia,421,51.8,1.3,8.1,398,-7.8,420,-1.4
55,Uruguay,409,55.8,1.4,-1.4,411,-1.8,416,-2.1
53,Mexico,413,54.7,0.6,3.1,424,1.1,415,0.9
54,Montenegro,410,56.6,1,1.7,422,5,410,-0.3
61,Jordan,386,68.6,0.6,0.2,399,-0.3,409,-2.1
59,Argentina,388,66.5,0.3,1.2,396,-1.6,406,2.4
58,Brazil,391,67.1,0.8,4.1,410,1.2,405,2.3
62,Colombia,376,73.8,0.3,1.1,403,3,399,1.8
60,Tunisia,388,67.7,0.8,3.1,404,3.8,398,2.2
57,Albania,394,60.7,0.8,5.6,394,4.1,397,2.2
63,Qatar,376,69.6,2,9.2,388,12,384,5.4
64,Indonesia,375,75.7,0.3,0.7,396,2.3,382,-1.9
65,Peru,368,74.6,0.6,1,384,5.2,373,1.3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content>
 </entry>
 
 <entry>
   <title>Installing oce in R</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/30/installing-oce.html"/>
   <updated>2013-12-30T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/30/installing-oce</id>
   <content type="html">&lt;p&gt;Several of the blog items have used the oce package. The official version of this can be installed from within R by&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;install.packages&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;oce&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;and more up-to-date versions can be installed using the &lt;code&gt;devtools&lt;/code&gt; package written by Hadley Wickham, which is itself installed with&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;install.packages&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;devtools&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;after which installing the latest development version of oce is accomplished with&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;devtools&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
install_github&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;ocedata&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;#39;dankelley&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;#39;master&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
install_github&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;oce&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;#39;dankelley&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;#39;develop&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Note that the &lt;code&gt;ocedata&lt;/code&gt; package does not need to be updated frequently, as it only updated when new datasets are added to oce. The official version of oce is only updated every few months, but the branch named &lt;code&gt;develop&lt;/code&gt; (used above) may be updated several times a day, if the author is adding new features or fixing bugs.&lt;/p&gt;

&lt;p&gt;For more on oce, see the &lt;a href=&quot;http://dankelley.github.io/oce/&quot;&gt;oce website on github&lt;/a&gt;.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>R interface to WebTide</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/29/r-interface-to-webtide.html"/>
   <updated>2013-12-29T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/29/r-interface-to-webtide</id>
   <content type="html">&lt;p&gt;A previous posting explained how to install WebTide on an OSX machine. This one shows how to hook up to an installed WebTide database, so that R code can get tidal predictions.&lt;/p&gt;

&lt;p&gt;The following code in the R language will produce a graph in which the top panel mimics the tidal-elevation graph produced by WebTide itself (see previous blog posting for comparison).&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
tStart &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2013-12-29 14:21:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
tEnd &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2014-01-13 15:21:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
time&lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt;seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;tStart&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tEnd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; by&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;15&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; units&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;minutes&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
prediction &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; webtide&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;predict&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-65.06747&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;45.36544&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; time&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;time&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;a href=&quot;/assets/webtide1.png&quot;&gt;&lt;img src=&quot;/assets/webtide-thumbnail1.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One of the advantages of accessing the tidal prediction from within oce is to make it easier to undertake further analysis, e.g. a node nearer Halifax has a mixed tide, with the following illustrating in terms of velocity and a so-called progressive vector.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;p &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; webtide&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;predict&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; node&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;14569&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;u&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; p&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;v&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;o&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
dt &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; diff&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;as.numeric&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;time&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]))&lt;/span&gt;
x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; dt &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cumsum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;u&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; dt &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cumsum&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;p&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;v&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;o&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;a href=&quot;/assets/webtide2.png&quot;&gt;&lt;img src=&quot;/assets/webtide-thumbnail2.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Installing WebTide in OSX</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/29/installing-webtide-in-osx.html"/>
   <updated>2013-12-29T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/29/installing-webtide-in-osx</id>
   <content type="html">&lt;p&gt;This blog item explains how to install WebTide, a tidal prediction application, on an OSX machine. The work requires moderate expertise, being carried out in the console, and requiring that a C compiler be found on the host machine.&lt;/p&gt;

&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;WebTide comes with a friendly graphical user interface that makes it easy to get tidal predictions at various locations around the world. Anyone with an interest in oceanography is likely to find it a useful application. Although the interface is slightly quirky (particularly for map navigation), it only takes a few minutes to learn. (An upcoming blog entry will explain how to avoid the WebTide interface, using the &lt;code&gt;oce&lt;/code&gt; R package to access the data that underly WebTide.)&lt;/p&gt;

&lt;h1 id=&quot;installation&quot;&gt;Installation&lt;/h1&gt;

&lt;p&gt;Step 1. Download the linux-without-Java-VM version from the &lt;a href=&quot;http://www.bio.gc.ca/science/research-recherche/ocean/webtide/index-eng.php&quot;&gt;Bedford Institute of Oceanography&lt;/a&gt; website, and store the results in the &lt;code&gt;~/Downloads&lt;/code&gt; directory.&lt;/p&gt;

&lt;p&gt;Step 2. Open a terminal or console window, and type the following to enter the WebTide directory and start the process of installing WebTide.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;&lt;span class=&#39;nb&#39;&gt;cd&lt;/span&gt; ~/Downloads
sh WebTide_unix_0_7.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After a moment, a dialog box will pop up, asking where WebTide is to be installed. To install a version just for you, supply &lt;code&gt;/Users/USERNAME/WebTide&lt;/code&gt;, where &lt;code&gt;USERNAME&lt;/code&gt; is your username. To install a version for all accounts on the computer, use the default, which is &lt;code&gt;/usr/local/WebTide&lt;/code&gt;. A second dialog box addresses the issue of symlinks. Click the box indicating that these are not to be used. After a few moments, a final dialog box will appear, stating that the work has been completed. Click the button named &lt;code&gt;Finish&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Step 3. Now for the OSX-specific part of the work. You will need the gcc compiler to do this. It is available for free on the Apple website, as the Xcode development tools. (If you have been using the computer for science, it is quite likely you have already installed a compiler, so just try the steps below, before bothering with a re-install of Xcode.) In a console, type the following to enter the source directory (here assumed to be configured for a single user) and to compile two programs.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;&lt;span class=&#39;nb&#39;&gt;cd&lt;/span&gt; ~/WebTide/Tidecor_src
gcc -O2 -o tidecor webtidecor2.5.1.c -lm
gcc -O2 -o constituentinterpolator constituentinterpolator1.1.c -lm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the two &lt;code&gt;gcc&lt;/code&gt; lines shown above, it may be necessary to change the names of the &lt;code&gt;&amp;quot;.c&amp;quot;&lt;/code&gt; files, to match whatever you find in this &lt;code&gt;tidecor_src&lt;/code&gt; directory. You may ignore the warning messages that are likely to appear, but if errors appear, you will need to interrupt this tutorial to find out what is wrong. Possibly leaving a comment on this site would encourage another reader to offer a solution; possibly the scientists at the Bedford Institute of Oceanography (named on the website) could help.&lt;/p&gt;

&lt;p&gt;Step 4. Move these newly-compiled programs from the source directory into the bin directory, by typing&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;mv tidecor ../bin
mv constituentinterpolator ../bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;using_webtide&quot;&gt;Using WebTide&lt;/h1&gt;

&lt;p&gt;If you installed WebTide to your home directory, launch WebTide by typing the following in a console window&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;~/WebTide/WebTide
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and use the GUI from that point on. If you installed it to &lt;code&gt;/usr/local/WebTide&lt;/code&gt;, type the following instead&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;/usr/local/WebTide/WebTide
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The main WebTide window looks like the following.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/webtideosx1.png&quot;&gt;&lt;img src=&quot;/assets/webtideosx1-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There is little point in explaining the details of the menu and mouse actions here, since WebTide provides its own documentation. In most cases, the action will be to click the mouse on spot on the map, to set a so-called “marker” for a location at which calculations are to be done. The diagram shown here has a marker in the Bay of Fundy. Once a marker has been set, the user may wish to click a menu item (see at the right-hand side) to get a tidal prediction, as shown in the screenshot below.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/webtideosx2.png&quot;&gt;&lt;img src=&quot;/assets/webtideosx2-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Sundial calculations</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/28/sundial.html"/>
   <updated>2013-12-28T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/28/sundial</id>
   <content type="html">&lt;p&gt;After experimenting with calculations for what I eventually came to realize were analemma-based sundials (with shadow cast by a vertical pole), I remembered that the common sundial has a wedge as the shadow-maker. A bit of research told me that the wedge is called a gnomon. It is a right triangle with one vertex (the centre vertex, shall we say) having angle equal to the local latitude. If this wedge is placed upright on a horizontal plane with the centre vertex aligned south and the 90deg vertex aligned north, then the shadow will produce a line that indicates the hour of the day. This works throughout the year, with approximately quarter-hour adjustments being required through the seasons.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;http://www.r-project.org&quot;&gt;R&lt;/a&gt; code given below the diagram creates an outline of the expected edge of the shadow of the gnomon. To illustrate the variation in angle through the year (which relates to the so-called equation of time), colours are used to indicate four significant times during the year.&lt;/p&gt;

&lt;p&gt;Printed at full scale, the diagram might be suitable for laying out the horizontal scale for a sundial. Naturally, readers must alter the latitude and longitude if they do not live in Halifax, Nova Scotia.&lt;/p&gt;

&lt;p&gt;A few notes:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;The gnomon hypotenuse will point to the pole star (Polaris) when the apparatus is aligned properly towards the north.&lt;/li&gt;

&lt;li&gt;Calling the function with &lt;code&gt;debug=1&lt;/code&gt; will show dots along the radial lines. These are the shadows of virtual points lying along the hypotenuse of the gnomon, and provide a check against errors in the calculation (since they should lie along a line if the gnomon angle matches the latitude).&lt;/li&gt;

&lt;li&gt;Noon is not aligned with North because the longitude is not an even multiple of 15 degrees.&lt;/li&gt;

&lt;li&gt;The length of the shadow provides extra information, but here this information is not shown (the lengths are normalized in lines 33 to 35 of the code.)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;a href=&quot;/assets/sundial_with_gnomon.png&quot;&gt;&lt;img src=&quot;/assets/sundial_with_gnomon-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;span class=&#39;c1&#39;&gt;## gnonom style sundial&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt;
    png&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;sundial_with_gnomon.png&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; width&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; height&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;6&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; unit&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;in&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
        res&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pointsize&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;13&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
sundial &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-63.60&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;44.65&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    days&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2014-03-20&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;2014-06-20&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;2014-09-23&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;2014-12-21&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                    keys&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Spring equinox&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Summer solstice&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                           &lt;span class=&#39;s&#39;&gt;&amp;quot;Autumn equinox&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;Winter solstice&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                    debug&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    col &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;
    glwd &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;8&lt;/span&gt;
    timezone &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; floor&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0.5&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; lon &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;15&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    L &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;                           &lt;span class=&#39;c1&#39;&gt;# horiz gnomon length (arbitrary)&lt;/span&gt;
    nhours &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;24&lt;/span&gt;
    first &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;TRUE&lt;/span&gt;
    &lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;season &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
        hours &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq.POSIXt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;days&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;season&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                            by&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;1 hour&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;nhours&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        &lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;hour &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; seq_along&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;hours&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
            t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; hours&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;hour&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
            tlocal &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; t &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3600&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; timezone
            sa &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; sunAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;lon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;lat&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            gy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; L&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            gx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;gy&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
            gz &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; gy &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; tan&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lat &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            R &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; gz &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; tan&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;sa&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;c1&#39;&gt;# radius of shadow&lt;/span&gt;
            theta &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; sa&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;
            par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
            x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; gx &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; R &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;theta&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; gy &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; R &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;theta&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
            len &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; max&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sqrt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;^&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
            x &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; x &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; len &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; L
            y &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; y &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; len &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; L
            &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sa&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
                &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;first&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
                    first &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;
                    D &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; L &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;
                    plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;n&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; asp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                         xlim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;L&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; L&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; ylim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;L&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; L&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                         axes&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;col&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;season&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; xlab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    &lt;span class=&#39;c1&#39;&gt;## Draw gnomon as a gray bar&lt;/span&gt;
                    segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; L&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;glwd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;gray&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
                    abline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;h&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.5&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;lwd&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; lty&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;dotted&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    abline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;v&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.5&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;lwd&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; lty&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;dotted&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;South&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; at&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;West&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; at&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;North&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; at&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;East&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; at&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topright&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;glwd&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;gray&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                           legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Gnomon&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;bottomright&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                           legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;sprintf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;%.3fE %.3fN&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
                    legend&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;topleft&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                           legend&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;keys&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    box&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
                    points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;col&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;season&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
                &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
                    segments&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;col&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;season&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
                    &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;debug&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                        points&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
                &lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;season&lt;span class=&#39;o&#39;&gt;==&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
                    xend &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; tail&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    yend &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; tail&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                    text&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.05&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;xend&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1.05&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;yend&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; format&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;tlocal&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;%H&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
                &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

            &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
        &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt;
    dev.off&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</content>
 </entry>
 
 <entry>
   <title>Analemma graphs</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/27/analemma.html"/>
   <updated>2013-12-27T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/27/analemma</id>
   <content type="html">&lt;p&gt;Continuing on the theme of solar angles, the code given below produces an analemma diagram similar to that of Lynch (2012, figure 2).&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
loc &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; list&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-0.0015&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;51.4778&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;  &lt;span class=&#39;c1&#39;&gt;# Greenwich Observatory&lt;/span&gt;
t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq.POSIXt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2014-01-01 12:00:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2015-01-01 12:00:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                by&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;1 d&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
sa &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; sunAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;loc&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;lon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;loc&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;lat&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;c1&#39;&gt;# tighten margins&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sa&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; sa&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;p&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     xlab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Azimuth&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Altitude&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;a href=&quot;/assets/analemma.png&quot;&gt;&lt;img src=&quot;/assets/analemma-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;p&gt;Peter Lynch, 2012. The equation of time and the analemma. Irish Math. Soc. Bulletin, 69:47-56. &lt;a href=&quot;http://www.maths.tcd.ie/pub/ims/bull69/Lynch.pdf&quot;&gt;PDF&lt;/a&gt;&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>A new Oce coastline</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/22/coastline.html"/>
   <updated>2013-12-22T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/22/coastline</id>
   <content type="html">&lt;h1 id=&quot;part_1_coastal_applications&quot;&gt;Part 1: coastal applications&lt;/h1&gt;

&lt;p&gt;The oce package has a world coastline file that is visibly crude on a scale suitable for continental-shelf work.  At the cost of about 1 Mbyte of storage, a candidate for a replacement is a 1:10million scale version downloaded from naturalearthdata.com (full link below).&lt;/p&gt;

&lt;p&gt;As illustrated below with plots near two oceanographic centres, this candidate provides noticeably more detail. (The code is in Appendix 1.)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/coastline-switch-1.png&quot;&gt;&lt;img src=&quot;/assets/coastline-switch-1-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The diagram argues for a switch. A factor in such a decision, though, has to be storage requirements. The 1:10M file is 8.4 Mbyte as provided by Natural Earth, but it becomes a 3.0 Mbyte file in R format, which is to be compared with the 1.8 Mbyte file for the coastline that was used in Oce previously. The old coastline had 406694 points, while the 1:10m version has 552670 points (i.e. 30% more points); the mismatch between data-size ratio and file-size ratio perhaps has something to do with compression.&lt;/p&gt;

&lt;h1 id=&quot;part_2_global_applications&quot;&gt;Part 2: global applications&lt;/h1&gt;

&lt;p&gt;As explained in Part 1, the existing coastline in &lt;code&gt;oce&lt;/code&gt; is noticeably coarse on scales commonly used in coastal-ocean work. A better alternative is the 1:10m coastline provided at the &lt;a href=&quot;http://www.naturalearthdata.com&quot;&gt;Natural Earth website&lt;/a&gt;. That site also provides 1:50m and 1:100m versions, and this entry illustrates those as well, with an aim to deciding whether to include these in &lt;code&gt;oce&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The files are named &lt;code&gt;Existing&lt;/code&gt; (what is in oce as of early December 2013), &lt;code&gt;Fine&lt;/code&gt; (the 1:10m file), &lt;code&gt;Medium&lt;/code&gt; (the 1:50m file) and &lt;code&gt;Coarse&lt;/code&gt; (the 1:100m file). The latter three were downladed 2013 Dec and read into Oce with names &lt;code&gt;coastlineWorldFine&lt;/code&gt; etc, and then timing and graphical tests were done.&lt;/p&gt;

&lt;p&gt;A world map was plotted to a PNG file (R file &lt;code&gt;world.R&lt;/code&gt;, appendix 1), and it yielded the following times: Existing 6.3s, Fine 16.9s, Medium 0.63s, Coarse 0.14s. (For context, note that all four panels plot in under half a second with the x11 device commonly used for interactive work.) The corresponding size of the &lt;code&gt;.rda&lt;/code&gt; files are: Existing 1.8Mb, Fine 3.0Mb, Medium 0.5Mb, and Coarse 0.1Mb.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/coastline-switch-2.png&quot;&gt;&lt;img src=&quot;/assets/coastline-switch-2-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;At top-left is the existing coastline, which on this scale is very close in appearance to the Fine resolution case to its right, and the Medium resolution case below it. At bottom right is the Coarse case, which produces very similar overall features but misses many islands (see e.g. near Alaska and the Caribbean). Timing tests reveal the Existing coastline file to take 6.3s, Fine 17s, Medium 0.63s, and Coarse 0.14s. This argues against the use of Fine for interactive work on even continental scales, with Medium seeming to be the best choice at global scales, with its order of magnitude reduction in plotting time. (As a side note, speed improvements will be reflected in file sizes if PDF output is chosen.) As for the shelf scale, see the previous posting, which suggests the use of Fine at such scales.&lt;/p&gt;

&lt;h2 id=&quot;discussion_and_conclusion&quot;&gt;Discussion and conclusion&lt;/h2&gt;

&lt;p&gt;These results argue for replacing the existing coastline with the three variants from Natural Earth. This is also a good time to prune other datasets. Separate tests (not shown here) suggest that Fine is preferable to the present dataset named &lt;code&gt;coastlineMaritimes&lt;/code&gt;, so the latter can be dropped. Oce also contains a dataset named &lt;code&gt;coastlineSLE&lt;/code&gt; that is mainly of interest to the author (and, like any localized dataset, can always be loaded for detailed work).&lt;/p&gt;

&lt;p&gt;Subject to feedback from other oce users, all three Natural Earth datasets will be incorporated into Oce. The existing coastline (named &lt;code&gt;coastlineWorld&lt;/code&gt;) will be replaced with Medium. (Altering the name would break existing code.) The other datasets will be named &lt;code&gt;coastlineFine&lt;/code&gt; and &lt;code&gt;coastlineCoarse&lt;/code&gt;. The existing datasets for the Maritimes and SLE will be dropped. The changes will increase plot quality and speed, at the cost of a 1.7Mb increase in the size of the data package. The work will be done in a new branch called &lt;code&gt;coastline&lt;/code&gt; that will hang off the branch called &lt;code&gt;develop&lt;/code&gt;, and will be merged into the latter pending user approval and testing.&lt;/p&gt;

&lt;h2 id=&quot;appendix_1&quot;&gt;APPENDIX 1&lt;/h2&gt;

&lt;p&gt;The R code to make the first figure is provided below. Readers wishing to reproduce this will need to download the coastline file named in line 2, from the &lt;a href=&quot;http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip&gt;&quot;&gt;naturalearthdata website&lt;/a&gt;.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
d &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; read.oce&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;ne_10m_admin_0_countries.shp&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## Two panels illustrate two oceanographic centres.&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## Left panel: Halifax NS, with grey for existing&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## world coastline and blue for the 1:10m version&lt;/span&gt;
&lt;span class=&#39;c1&#39;&gt;## under consideration.&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorld&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; clon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-63.60&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; clat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;44.65&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; span&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;longitude&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; d&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;latitude&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;

&lt;span class=&#39;c1&#39;&gt;## As left panel, but for Woods Hole MA.&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorld&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; clon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-70.70&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; clat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;41.65&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; span&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;200&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;d&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;longitude&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; d&lt;span class=&#39;p&#39;&gt;[[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;latitude&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lwd&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h2 id=&quot;appendix_2&quot;&gt;APPENDIX 2&lt;/h2&gt;

&lt;p&gt;The R code used to make the second figure is given below. Readers should note that this will not work for them unless they first download the datasets, read the datasets with &lt;code&gt;read.oce()&lt;/code&gt;, and &lt;code&gt;save()&lt;/code&gt; the results in .rda files as named in the code.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
load&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;coastlineWorldFine.rda&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; 
load&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;coastlineWorldMedium.rda&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
load&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;coastlineWorldCoarse.rda&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt;
    png&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;world.png&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;width&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;height&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;unit&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;in&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;res&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;150&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;pointsize&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;rep&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
system.time&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mapPlot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorld&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
                    longitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-80&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; latitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;120&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                    projection&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;orthographic&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; axes&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    orientation&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;45&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; fill&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;grey&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
system.time&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mapPlot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorldFine&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    longitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-80&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; latitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;120&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                    projection&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;orthographic&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; axes&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    orientation&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;45&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;fill&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;grey&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
system.time&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mapPlot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorldMedium&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    longitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-80&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; latitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;120&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                    projection&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;orthographic&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; axes&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    orientation&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;45&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; fill&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;grey&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
system.time&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mapPlot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;coastlineWorldCoarse&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    longitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-80&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; latitudelim&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;120&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
                    projection&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;orthographic&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; axes&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;kc&#39;&gt;FALSE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                    orientation&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;45&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; fill&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;grey&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;!&lt;/span&gt;interactive&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt;
    dev.off&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</content>
 </entry>
 
 <entry>
   <title>Solstice sunrise-sunset</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/21/solstice.html"/>
   <updated>2013-12-21T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/21/solstice</id>
   <content type="html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;The &lt;code&gt;sunAngle()&lt;/code&gt; function in the &lt;code&gt;oce&lt;/code&gt; package provides a handy way to determine sunrise/sunset azimuth angles, and this is used to find alignments for the winter solstice in Halifax, NS.&lt;/p&gt;

&lt;h1 id=&quot;methods&quot;&gt;Methods&lt;/h1&gt;

&lt;p&gt;First, set up the problem; these may be the only lines that need editing for other places or times.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2013-12-21 17:11:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;c1&#39;&gt;# winter solstice&lt;/span&gt;
xy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; list&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-63.60&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; y&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;44.65&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;          &lt;span class=&#39;c1&#39;&gt;# centre of map (Halifax)&lt;/span&gt;
D &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;6&lt;/span&gt;                                 &lt;span class=&#39;c1&#39;&gt;# map span in km&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, use &lt;code&gt;sunAngle()&lt;/code&gt; from the &lt;code&gt;oce&lt;/code&gt; package to find the time of the sunrise and the azimuth at that moment. Here, &lt;code&gt;uniroot()&lt;/code&gt; is used to find the time when the altitude is zero (the sun is on the horizon), and we start searching a quarter-day before the time of the actual solstice.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
t0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; t &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;86400&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;
sunrise &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; uniroot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
                   sunAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
                   interval&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;as.numeric&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; t&lt;span class=&#39;p&#39;&gt;)))&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;root
sunrise &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; numberAsPOSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sunrise&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
azimuth &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;90&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; sunAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sunrise&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;azimuth
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;The span &lt;code&gt;D&lt;/code&gt; is given in kilometres, which we convert to degrees of latitude and longitude.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;D &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; D &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;111&lt;/span&gt;                           &lt;span class=&#39;c1&#39;&gt;# deg&lt;/span&gt;
Dlon &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; D &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; pi &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Now it is time to start with the mapping, which uses the &lt;code&gt;OpenStreetMap&lt;/code&gt; package.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;OpenStreetMap&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
map &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; openmap&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;D&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;Dlon&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
               c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;y&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;D&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;xy&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;x&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;Dlon&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
               minNumTiles&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;9&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;map&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Now, it remains to draw the sunrise/sunset lines. The variables &lt;code&gt;cx&lt;/code&gt; and &lt;code&gt;cy&lt;/code&gt; are the centre points of the map, in map units (not latitude and longitude).&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;cx &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;usr&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
cy &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; mean&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;usr&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
d &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; diff&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;usr&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;c1&#39;&gt;# scales as the map&lt;/span&gt;
&lt;span class=&#39;kr&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;o &lt;span class=&#39;kr&#39;&gt;in&lt;/span&gt; d&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    lines&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;cx&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;cos&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;azimuth&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
          cy&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;o&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;d&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;sin&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;azimuth&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;pi&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; col&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Finally, add a title so that plot is self-explanatory.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;sprintf&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;sunrise angles on day of winter solstice (%s)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
              format&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s&#39;&gt;&amp;quot;%Y-%m-%d&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)),&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; line&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; cex&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;The graph indicates the results; click it to zoom in.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/solstice_sunrise_sunset.png&quot;&gt;&lt;img src=&quot;/assets/solstice_sunrise_sunset-thumbnail.png&quot; alt=&quot;graph&quot; /&gt;&lt;/a&gt;&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Moon phase calculation</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/21/moon-phases.html"/>
   <updated>2013-12-21T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/21/moon-phases</id>
   <content type="html">&lt;p&gt;The illuminated fraction of the moon can be calculated with &lt;code&gt;moonAngle()&lt;/code&gt; in the oce package, as illustrated graphically and in R code below.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5
6
7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;c1&#39;&gt;# tighten margins&lt;/span&gt;
t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2013-12-1&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; seq&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;28&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3600&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3600&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
f &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; moonAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; longitude&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-63.6&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; 
                    latitude&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;44.65&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;illuminatedFraction
plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; f&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;l&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; xlab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Day of 2013&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Moon fraction&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;For interest, add full-moon time as indicated in an almanac.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;full &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2013-12-17 05:29:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;AST&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
abline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;v&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;full&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
mtext&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;full&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; at&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;full&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; side&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;&lt;img src=&quot;/assets/moon.png&quot; alt=&quot;moon phase diagram&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Exercises&lt;/em&gt; (a) Try this for other locations. (b) Detect full moon by using uniroot() on the rate of change of illumination.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Day length calculation</title>
   <link href="http://dankelley.github.io/blog//r/2013/12/21/day-length.html"/>
   <updated>2013-12-21T00:00:00-04:00</updated>
   <id>http://dankelley.github.io/blog/r/2013/12/21/day-length</id>
   <content type="html">&lt;p&gt;The winter solstice has been on many minds lately. The days are about to start getting longer … but just how fast will they do that?&lt;/p&gt;

&lt;p&gt;This post provides R that calculates and graphs day length and its variation, using &lt;code&gt;uniroot()&lt;/code&gt; to find sunrises and sunsets as indicated by solar altitude that is calculated with &lt;code&gt;sunAngle()&lt;/code&gt; in the oce package.&lt;/p&gt;

&lt;p&gt;The day of the solstice is indicated with vertical lines. All times are in UTC, which is the conventional system for scientific work and the one required by &lt;code&gt;sunAngle()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/daylength.png&quot; alt=&quot;daylength graph&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The first step in making the graph shown above is to load the &lt;code&gt;oce&lt;/code&gt; library and create a function that measures daylength by finding sunrise and sunset times. Note that &lt;code&gt;uniroot()&lt;/code&gt;, which is used to find times of zero solar altitude, needs lower and upper limits on &lt;code&gt;t&lt;/code&gt;, and these are calculated by looking back and then forward a half-day. This works well for application to Halifax, but in other timezones other offsets would be needed. Interested readers might want to devised a method based on the longitude, which can be transformed into a timezone.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;library&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;oce&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
daylength &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lon&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-63.60&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lat&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;44.65&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.numeric&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    alt &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#39;kr&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
        sunAngle&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; longitude&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;lon&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; latitude&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;lat&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;altitude
    rise &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; uniroot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;alt&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lower&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;t&lt;span class=&#39;m&#39;&gt;-86400&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; upper&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;root
    set &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; uniroot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;alt&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; lower&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; upper&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;t&lt;span class=&#39;m&#39;&gt;+86400&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;$&lt;/span&gt;root
    set &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; rise
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Next, use &lt;code&gt;lappy()&lt;/code&gt; to find the daylength for December, 2013.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;t0 &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2013-12-01 12:00:00&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
t &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; seq.POSIXt&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t0&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; by&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;1 day&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; length.out&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;*&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;31&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
dayLength &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; unlist&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;lapply&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; daylength&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Set up to plot two panels, with narrowed margins.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;par&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;mfrow&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mar&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; mgp&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Plot daylength in the top panel, indicating the day of the solstice with vertical lines.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4
5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; dayLength&lt;span class=&#39;o&#39;&gt;/&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;3600&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     xlab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Day length (hours)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
solstice &lt;span class=&#39;o&#39;&gt;&amp;lt;-&lt;/span&gt; as.POSIXct&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;2013-12-21&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; tz&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;UTC&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
abline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;v&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;solstice&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;86400&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;Plot daylength difference in the bottom panel, again indicating the solstice.&lt;/p&gt;
&lt;table class=&#39;highlighttable&#39;&gt;&lt;tr&gt;&lt;td class=&#39;linenos&#39;&gt;&lt;div class=&#39;linenodiv&#39;&gt;&lt;pre&gt;&lt;code class=&#39;r&#39;&gt;1
2
3
4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;plot&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;t&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;-1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; diff&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;dayLength&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; type&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;o&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; pch&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
     xlab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Day in 2013&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; ylab&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Seconds gained per day&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
grid&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
abline&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;v&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;solstice&lt;span class=&#39;o&#39;&gt;+&lt;/span&gt;c&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;m&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;m&#39;&gt;86400&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</content>
 </entry>
 

</feed>
