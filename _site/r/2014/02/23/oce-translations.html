<!DOCTYPE HTML>
<html>
<head>
<link rel='stylesheet' type='text/css' href='/css/syntax.css' />
<link rel='stylesheet' type='text/css' href='/css/style.css' />
<meta charset="UTF-8">
<title>Oce translations</title>
</head>

<body>
<div class="navbar">
    <!-- <div class="navbar-inner"> -->
        <!-- <a class="brand" href="/index.html">Dan Kelley</a> -->
        <!-- <div class="nav">Dan Kelley</div> -->
        <ul class="navbar">
            
            <li><a href="/index.html">Dan Kelley</a></li>
            

            
            <li><a href="/publications.html">Publications</a></li>
            

            
            <li><a href="/textbook.html">Textbook</a></li>
            

            
            <li><a href="/software.html">Software</a></li>
            
            
            <li><a class="highlight" href="/blog">Blog</a></li>
            

        </ul>
        <!-- </div> -->
</div>

<div id="content">
    




<!-- <div class="span8"> -->

<div class=topnav>

<!-- | <a href='/blog'>Home</a> | -->

<a class="pagination" href="/r/2014/02/19/filtfilt.html" title="Improved filtfilt() for R">
    <!-- &larr; --> Previous
</a>

</div> <!-- topnav -->


<div class="page-header">

    <div class=post_title>Oce translations</div>
<!-- </div> --> <!-- span8 -->

<!-- <div class="span4"> -->

<div class=slug>
    <span class=post_date>
        Feb 23, 2014
    </span> <!-- post_date -->
    <span class=post_tags>
        
        <a href="/tags/R/index.html" class="tag">
            R
        </a>
         &#183; 
        
        <a href="/tags/oce/index.html" class="tag">
            oce
        </a>
        
        
    </span> <!-- post_date -->
    <div class=post_summary>
        The method for adding additional languages to Oce graphics is described.
    </div> <!-- post_summary -->
</div> <!-- slug ->

<!-- </div> -->
<!-- span4 -->
</div> <!-- page-header -->



<p>A new user wondered how to get Spanish labels on axes, and so I started on the process of localizing the code, using the <a href="http://www.gnu.org/software/gettext/">GNU gettext</a> scheme. Gettext being unfamiliar to me, I stumbled a bit at first, and decided to document the successful steps here. Readers may wish to consult <a href="https://www.dropbox.com/sh/301wmxm4ddnv68v/7G85OTScZq">a Dropbox page</a> on my progress towards the goal of translating the main Oce plots into common languages. For now, I am focussing on Spanish, French, and Mandarin.</p>

<h2 id="initial_work_cycle">Initial work cycle</h2>

<h3 id="step_1">Step 1</h3>

<p>Create a directory named <code>oce/po/</code>.</p>

<h3 id="step_2">Step 2</h3>

<p>The basic procedure it to change a code fragment like</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='r'>1</code></pre></div></td><td class='code'><div class='highlight'><pre>ylab<span class='o'>=</span><span class='s'>&quot;Depth&quot;</span>
</pre></div>
</td></tr></table>
<p>which is clearly not appropriate in all langauges, into</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='r'>1</code></pre></div></td><td class='code'><div class='highlight'><pre>gettext<span class='p'>(</span><span class='s'>&quot;Depth&quot;</span><span class='p'>,</span> domain<span class='o'>=</span><span class='s'>&quot;R-oce&quot;</span><span class='p'>)</span>
</pre></div>
</td></tr></table>
<p>which yields an entry in a translation table that can then be tailored for any desired language. (The <code>gettext()</code> call should not really need to set the <code>domain</code>, but I found it necessary for some items, and decided to include it everywhere.)</p>

<h3 id="step_3">Step 3</h3>

<p>Enter the <code>oce</code> directory, launch R, and type as follows, to insert a file named <code>R-oce.pot</code> in the <code>po</code> directory.</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='r'>1</code></pre></div></td><td class='code'><div class='highlight'><pre>tools<span class='o'>::</span>update_pkg_po<span class='p'>(</span><span class='s'>&quot;.&quot;</span><span class='p'>)</span>
</pre></div>
</td></tr></table>
<p>This create a file that has entries for all errors, warnings, and messages, as well as for <code>gettext()</code> entries. The file will be named <code>po/R-oce.pot</code>, and will contain entry pairs such as the following.</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='bash'>1
2</code></pre></div></td><td class='code'><div class='highlight'><pre>msgid <span class='s2'>&quot;Depth&quot;</span>
msgstr <span class='s2'>&quot;&quot;</span>
</pre></div>
</td></tr></table>
<p>The first of these is a key, and the second is a replacement string (discussed presently). The details of the file format, and much else relating to <code>gettext</code> are available at the <a href="http://www.gnu.org/software/gettext/manual/gettext.html">GNU site</a>.</p>

<h3 id="step_4">Step 4</h3>

<p>To start work on, say, a French translation table, type the following in the shell.</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='bash'>1
2</code></pre></div></td><td class='code'><div class='highlight'><pre><span class='nb'>cd </span>oce/po
msginit --locale<span class='o'>=</span>R-fr --input R-oce.pot
</pre></div>
</td></tr></table>
<p>This creates an English-French translation table in a file named <code>po/R-fr.po</code>. This must be done just once for each language to be translated. The key is the <code>fr</code> part of the name, which is the <a href="http://en.wikipedia.org/wiki/ISO_639">ISO-639</a> code for French.</p>

<p>Once the file is created, look at it with a text editor and, if necessary, change the <code>charset</code> to <code>UTF-8</code>, which can handle most languages.</p>

<p>Importantly, running <code>msginit</code> is only necessary at the first stage of translation. As new entries are added, one must only follow the work cycle given below.</p>

<h3 id="step_5">Step 5</h3>

<p>Edit <code>po/R-fr.po</code> as desired, inserting translations. You will need a text editor that permits characters in a variety of languages; vim and emacs are ideal for this.</p>

<p>Simply change the <code>msgstr</code> item to the translated value, e.g. for French the <code>R-fr.po</code> file should contain</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='bash'>1
2</code></pre></div></td><td class='code'><div class='highlight'><pre>msgid <span class='s2'>&quot;Depth&quot;</span>
msgstr <span class='s2'>&quot;Profondeur&quot;</span>
</pre></div>
</td></tr></table>
<p>for this entry.</p>

<h2 id="update_work_cycle">Update work cycle</h2>

<p>The work cycle is as follows.</p>

<ol>
<li>
<p>Edit the R source code, replacing strings like <code>FOO</code> with <code>gettext(&quot;FOO&quot;, &quot;R-oce&quot;)</code>.</p>
</li>

<li>
<p>Launch R in the <code>oce</code> directory and invoke <code>tools::update_pkg_po(&quot;.&quot;)</code> to add an entry to the <code>po/R-oce.pot</code> file, with corresponding entries in <code>po/R-fr.po</code> and any other existing translation files.</p>
</li>

<li>
<p>Edit <code>po/R-fr.po</code> and any other translation files, changing the <code>msgstr</code> entry that corresponds to <code>FOO</code>.</p>
</li>

<li>
<p>Run <code>tools::update_pkg_po(&quot;.&quot;)</code> again, to update all relevant files in the <code>inst</code> directory.</p>
</li>

<li>
<p>Build and test oce.</p>
</li>

<li>
<p>Repeat from step 1 as required for other words.</p>
</li>
</ol>

<p>Since step 5 is slow, it helps to be watching your country win a gold medal in the Olympics hockey game, while you are doing such work.</p>

<h2 id="an_example">An example</h2>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='r'>1
2
3
4
5
6
7
8</code></pre></div></td><td class='code'><div class='highlight'><pre>library<span class='p'>(</span>oce<span class='p'>)</span>
data<span class='p'>(</span>ctd<span class='p'>)</span>
par<span class='p'>(</span>mfrow <span class='o'>=</span> c<span class='p'>(</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>))</span>
plotProfile<span class='p'>(</span>ctd<span class='p'>,</span> <span class='s'>&quot;T&quot;</span><span class='p'>)</span>
Sys.setenv<span class='p'>(</span>LANGUAGE <span class='o'>=</span> <span class='s'>&quot;es&quot;</span><span class='p'>)</span>
plotProfile<span class='p'>(</span>ctd<span class='p'>,</span> <span class='s'>&quot;T&quot;</span><span class='p'>)</span>
Sys.setenv<span class='p'>(</span>LANGUAGE <span class='o'>=</span> <span class='s'>&quot;fr&quot;</span><span class='p'>)</span>
plotProfile<span class='p'>(</span>ctd<span class='p'>,</span> <span class='s'>&quot;T&quot;</span><span class='p'>)</span>
</pre></div>
</td></tr></table>
<p>produces the graph shown below (click to enlarge).</p>

<p><a href="/assets/2014-02-21-oce-translations.png"><img src="/assets/2014-02-21-oce-translations-thumbnail.png" alt="center" /></a></p>

<h2 id="using_translations">Using translations</h2>

<p>In most cases the system language will be set with system tools. Still, <code>Sys.setenv()</code> can be handy for switching the language used in a plot (e.g. a French user may have the computer set up to work in French, but may prefer to graph data using English, for publication). Commonly, <code>Sys.setenv()</code> will be done in the R startup file, or defined in the OS shell, e.g. below for a temporary use</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='bash'>1</code></pre></div></td><td class='code'><div class='highlight'><pre><span class='nv'>LANG</span><span class='o'>=</span>es_ES.UTF-8 R --no-save &lt; spanish.R
</pre></div>
</td></tr></table>
<h2 id="helping_me_with_the_translation_effort">Helping me with the translation effort</h2>

<p>At the moment, Oce works in English, with some support for Spanish and French, and just a few test words for Mandarin. (For Mandarine, be sure to specify your PDF plot device as e.g. <code>pdf(..., family=&quot;BG1&quot;)</code> so that proper fonts will be loaded.)</p>

<p>If you would like Oce graphs to work in another language with which you have high familiarity, please contact me. I will need you to write down a few relevant words in your language and send them to me via PDF or scanned hand-written document (MSword and OpenOffice formats cannot are not useful). Minimally, the words should be the ones used on axes of the graphs you use, but it would help other users if you could translate the phrases listed below. Also, translate <code>E</code>, <code>W</code>, <code>N</code>, and <code>S</code>, as used in longitude and latitude, as well as any other unit abbreviations that differ between English and your language.</p>
<table class='highlighttable'><tr><td class='linenos'><div class='linenodiv'><pre><code class='bash'> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</code></pre></div></td><td class='code'><div class='highlight'><pre>Absolute Salinity
Conservative Temperature
Depth
Distance
Elevation
Longitude
Latitude
Potential Temperature
Potential Density Anomaly
Practical Salinity
Pressure
Sea Level
Speed
Temperature
Velocity
</pre></div>
</td></tr></table>
<p>For some languages (especially Asian ones) it is best to send me a UTF-8 file with the translated phrases that I can copy and paste into the source files. For example, below is a screenshot showing a rough guess at Mandarin, which I found by using an onine translation engine.</p>

<p><img src="/assets/2012-02-21-translation-editor.png" alt="center" /></p>

<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'dankelleydalhousie'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

<p class="footnote">This website is written in <a
href="http://jekyllrb.com">Jekyll</a>, and the source is available on <a
href="https://github.com/dankelley/dankelley.github.io">GitHub</a>.</p>

</body>
</html>

