<h2 id="n2runlma_figpath20140210__dpi100">—-N2-runlm-a, fig.path=’2014-02-10_’, dpi=100————————-</h2>

<p>library(oce) data(ctd) rho &lt;- swRho(ctd) z &lt;- swZ(ctd) drhodz &lt;- runlm(z, rho, deriv=1) g &lt;- 9.81 rho0 &lt;- mean(rho, na.rm=TRUE) N2 &lt;- -g * drhodz / rho0 plot(ctd, which=’N2’) lines(N2, -z, col=’blue’) legend(“bottomright”, lwd=2, col=c(“brown”, “blue”), legend=c(“spline”, “runlm”), bg=”white”)</p>

<h2 id="">{}</h2>

<p>N2 &lt;- swN2(ctd) N2fromderiv &lt;- function(L) { - g * runlm(z, rho, L=L, deriv=1) / rho0 } best &lt;- optimize(function(L) sqrt(mean((N2 - N2fromderiv(L))^2)), interval=c(1, 100)) print(best) N2best &lt;- N2fromderiv(best$minimum)</p>

<h2 id="n2runlmb_figpath20140210__dpi100">—-N2-runlm-b, fig.path=’2014-02-10_’, dpi=100————————-</h2>

<p>plotProfile(ctd, “N2”) lines(N2best, ctd[[‘pressure’]], col=”red”)</p>